let Import;((J,z,H)=>{'use strict';Import={importImages(){return J.importJs(J.url+'js/admin/import/import-images')},init(I,v,S,k,x,N){return new Promise(async(t,e)=>{let m=!0;this.importImages();const c=(await J.importJs(J.url+'js/admin/notification')).Notification,i=I.length,r=12<i?150:100,g=k.import_skip,_=[],l=0<k.limit?parseInt(k.limit):5,s=k.images_chunk,n=!!k.skip_builder,h=i=>{const l=[];for(let e=0,t=i.length;e<t;++e){let t='';i[e].tbp_template_name!==H?t=i[e].tbp_template_name:i[e].post_title!==H?t=i[e].post_title:i[e].title!==H?t=i[e].title.rendered!==H?i[e].title.rendered:i[e].title:i[e].name===H&&i[e].post_name===H||(t=i[e].name),t!==H&&''!==t&&l.push(t)}return 0===l.length?'':l.join(', ')},d=l=>new Promise((e,i)=>{setTimeout(()=>{let t={action:v,id:x||'',nonce:S,data:l};k.custom_params&&(t=Object.assign(t,k.custom_params)),J.fetch(t).then(t=>{(t&&t.success&&t.data?e:i)(t)}).catch(i)},r)}),o=()=>{m='visible'===z.document.visibilityState},u=(t,e)=>{const i=[];for(;0<t.length;)i.push(t.splice(0,e));return i},a=(e,f)=>new Promise(async t=>{let l=0,n=new Set,r=e.length,o=k.loading.replaceAll('%to%',r),a=u(e,f);for(let t=0;t<a.length;++t){let s=a[t];if(0<s.length){let e=h(s),i;if(1<r&&!0===m){l+=s.length;let t=o.replaceAll('%from%',l).replaceAll('%post%',e);120<t.length&&(t=t.slice(0,120)+'...'),await c.show('info',t)}try{i=await d(s)}catch(t){try{i=await d(new Blob([JSON.stringify(s)],{type:'application/json'}))}catch(t){}}finally{if(i&&i.success&&i.data){let r=!1;const p=i.data;for(let i in p){let l=p[i];for(let e=s.length-1;-1<e;--e)if(s[e]!==H){let t=s[e].term_id||s[e].ID||s[e].post_id;if(i==t){if(!1===l)n.add(s[e]);else if('object'==typeof l||isNaN(l)){let t='object'==typeof l?l.msg:l;if(!0===m&&await c.showHide('warning',g.replaceAll('%post%',h([s[e]]))+':'+t,2e3),'object'==typeof l&&l.skip){for(let e=s.length-1;-1<e;--e){let t=s[e].post_type||s[e].taxonomy;t===l.skip&&s.splice(e,1)}for(let i=a.length-1;-1<i;--i){for(let e=a[i].length-1;-1<e;--e){let t=a[i][e].post_type||a[i][e].taxonomy;t===l.skip&&(a[i].splice(e,1),r=!0)}0===a[i].length&&a.splice(i,1)}}}else!0!==l&&(s[e].term_thumb?_.push({term_id:l,url:s[e].term_thumb.trim()}):s[e].thumb&&_.push({id:l,url:s[e].thumb.trim()}));s[e]!==H&&s.splice(e,1);break}}}if(!0===r){for(let t=(a=a.flat()).length-1;-1<t;--t)0===a[t].length&&a.splice(t,1);t=-1,a=u(a,f)}}else{!0===m&&await c.showHide('error',g.replaceAll('%post%',e),2e3);for(let t=s.length-1;-1<t;--t)n.add(s[t])}}}}t(n)}),p=t=>(t.preventDefault(),t.returnValue='Are you sure'),f=l=>{if(!Array.isArray(l)){const e=[];for(let t in l)e.push(l[t]);l=e}for(let t=l.length-1;-1<t;--t){let i=l[t].cols;if(i){if(!Array.isArray(i)){let e=[];for(let t in i)e.push(i[t]);i=l[t].cols=e}for(let t=i.length-1;-1<t;--t)i[t].modules&&(i[t].modules=f(i[t].modules))}}return l},y=i=>{for(let t=i.length-1;-1<t;--t){if(i[t].styling&&0<Object.keys(i[t].styling).length)return!0;let e=i[t].modules;if(e&&0<e.length)for(let t=e.length-1;-1<t;--t){if(!e[t].cols)return!0;if(y(e[t].cols))return!0}}return!1};z.tfOff('beforeunload',p).tfOn('beforeunload',p).document.tfOff('visibilitychange',o,{passive:!0}).tfOn('visibilitychange',o,{passive:!0});let b=new Map;k.custom_data=x||'default',k.stop_webp=1;try{let l=new Set;for(let t=I.length-1;-1<t;--t){let i=(I[t].meta_input||I[t])._themify_builder_settings_json;if(i){'string'==typeof i&&(i=JSON.parse(i)),i=f(i);let e=!1;for(let t=i.length-1;-1<t;--t)if(i[t].styling&&0<Object.keys(i[t].styling).length||i[t].cols&&y(i[t].cols)){e=!0;break}if(!1===e)I[t].meta_input?delete I[t].meta_input._themify_builder_settings_json:delete I[t]._themify_builder_settings_json;else if(0==n){let t=(t=>{const i=new Set,r=t=>{if(t){const e=t.split('?')[0].split('.');-1!==['jpg','jpeg','tiff','png','gif','bmp','svg','webp','apng'].indexOf(e[e.length-1])&&i.add(t)}},l=e=>{for(let t in e)if(e[t])if(Array.isArray(e[t])||'object'==typeof e[t])l(e[t]);else{let i=e[t].toString().trim();if(i)if(-1!==i.indexOf('<img ')){let t=document.createElement('template'),l=(t.innerHTML=i,t.content.querySelectorAll('img'));for(let i=l.length-1;-1<i;--i){let t=l[i].src,e=l[i].srcset;e=e?e.split(' '):[],t&&e.push(t);for(let t=e.length-1;-1<t;--t)e[t]&&r(e[t].trim())}}else if('['===i[0]&&-1!==i.indexOf('path=')){let e=i.match(/\path.*?=.*?[\'"](.+?)[\'"]/gim);if(e&&e[0])for(let t=(e=e[0].split('path=')[1].replaceAll('"','').replace("'",'').split(',')).length-1;-1<t;--t)e[t]&&r(e[t].trim())}else r(i)}};return l(t),i})(i);0<t.size&&(l=new Set([...l,...t]))}}if(I[t]._product_image_gallery){let e=I[t]._product_image_gallery;for(let t=(e='string'==typeof e?e.split(','):e).length-1;-1<t;--t)l.add(e[t].trim())}}if(0<l.size){const j=(await this.importImages()).ImportImages;b=await j.init([...l],S,k,s,N);for(let r=I.length-1;-1<r;--r){let i=(I[r].meta_input||I[r])._themify_builder_settings_json;if(i){'string'!=typeof i&&(i=JSON.stringify(i));for(let[t,e]of b)!1!==e&&e.src&&(-1!==i.indexOf(t)&&(i=i.replaceAll(t,e.src)),I[r].post_content&&-1!==I[r].post_content.indexOf(t)&&(I[r].post_content=I[r].post_content.replaceAll(t,e.src)));i=JSON.parse(i),I[r].meta_input&&I[r].meta_input._themify_builder_settings_json?I[r].meta_input._themify_builder_settings_json=i:I[r]._themify_builder_settings_json=i}if(I[r]._product_image_gallery){let i=I[r]._product_image_gallery,l=[];i='string'==typeof i?i.split(','):i;for(let e=0,t=i.length;e<t;++e){let t=b.get(i[e].trim());t&&l.push(t.id)}0<l.length?I[r]._product_image_gallery=l.join(','):delete I[r]._product_image_gallery}}}}catch(t){}let w=await a(I,l);if(0<w.size&&0<(w=await a([...w],2)).size&&!0===m&&await c.showHide('error',k.import_failed.replaceAll('%post%',h(Array.from(w))),4e3),w.size===i)e(Array.from(w));else{if(0<_.length){const A=(await this.importImages()).ImportImages;try{const O=await A.init(_,S,k,s,N);b=new Map([...O,...b])}catch(t){}}t([b,w])}z.tfOff('beforeunload',p).document.tfOff('visibilitychange',o,{passive:!0})})},sort(r,s,n){const o=new Set,a=t=>{const e=parseInt(n===H?t[s]:t[s][n]),i=0<t.term_id?'term_id':'ID';for(var l=r.length-1;-1<l;--l)if(0<r[l][i]&&parseInt(r[l][i])===e){let t=r[l][s];0<(t=n!==H?t[n]:t)&&a(r[l]),o.add(r[l])}};for(var e=r.length-1;-1<e;--e){let t=r[e][s];(t=n!==H?t[n]:t)!==H&&0!=t||(o.add(r[e]),r.splice(e,1))}for(e=r.length-1;-1<e;--e){let t=r[e][s];0<(t=n!==H?t[n]:t)&&(a(r[e]),o.add(r[e]))}return[...o]}}})(Themify,window.top,void 0);export{Import};