let ImportImages;((T,O,x,M)=>{'use strict';ImportImages={downloaded:new Map,_getImage(a,i){return new Promise((t,e)=>{setTimeout(()=>{this._download(a).then(t).catch(e)},i)})},async _download(t){const e=this.downloaded.get(t);if(e!==M)return e;if(-1===t.indexOf('themify.me'))return 1;try{return await T.fetch('','blob',{credentials:'omit',method:'GET',mode:'cors'},t)}catch(t){return 404!==t.status&&1}},async _batchDownload(i,l){const e=()=>{const a=[];for(let t=0,e=i.length;t<e;++t)a.push(this._getImage(i[t],l));return Promise.all(a)};let a;try{a=await e()}catch(t){try{a=await e()}catch(t){a=Array(i.length).fill(1)}}return a},async _batchUpload(a,i){let l;try{l=await this._upload(a,i)}catch(t){try{l=await this._upload(a,i)}catch(t){try{let e=a.getAll('blob');for(let t=e.length-1;-1<t;--t)delete e[t].blob;a.set('blob',e),l=await this._upload(a,i)}catch(t){}}}return l},_upload(t,i){return new Promise((e,a)=>{setTimeout(()=>{T.fetch(t).then(t=>{t&&t.success?e(t):a(t.data)}).catch(a)},i)})},init(A,D,k,I,P){return new Promise(async t=>{Array.isArray(A)||(A=[...A]);let r=!0,s=0,n=!1,c=!1;I=I||2,P=P||'themify_upload_image';const d=(await T.importJs(T.url+'js/admin/notification')).Notification,h=A.length,m=k.download_images?k.download_images.replaceAll('%to%',h):'',f=k.upload_images?k.upload_images.replaceAll('%to%',h):'',p=k.download_fail||'',w=k.upload_fail||'',e=k.custom_data||'',a=k.stop_webp||'',u=(new Map,new Map),g=12<h?150:100,i=[],y=a=>{const i=[];for(let e=0,t=a.length;e<t;++e){let t=('string'==typeof a[e]?a[e]:a[e].url).trim();-1!==t.indexOf('themes/ultra-agency-2/')&&(t=t.replace('/themes/ultra-agency-2/files/','/themes/ultra-agency2/files/')),i.push(t)}return i},_=a=>{for(let e=(a=y(a)).length-1;-1<e;--e)this._download(a[e]).then(t=>{this.downloaded.set(a[e],t)})},l=t=>(t.preventDefault(),t.returnValue='Are you sure'),o=()=>{r='visible'===x.document.visibilityState},b=(o,r)=>{const s=new FormData,n={},c=y(o),d=new Set;for(let l=r.length-1;-1<l;--l)if(o[l]!==M){let t=o[l],e='string'==typeof t,a=c[l],i=r[l];!1!==i&&'skip'!==i?(s.set(l,i),!(n[l]={thumb:a})==e&&(t.id&&(n[l].post_id=t.id),t.term_id&&(n[l].term_id=t.term_id),t.data&&(n[l].data=t.data))):(d.add(a),u.set(a,!1))}return s.set('action',P),s.set('nonce',D),s.set('postData',JSON.stringify(n)),e&&s.set('save_id',e),a&&s.set('stop_webp',1),{formData:s,skip:d}},v=(a,i)=>{a&&a.success||a?a.data&&(a=a.data):a='';const l=new Map;for(let e=i.length-1;-1<e;--e){let t=this.downloaded.get(i[e]);if(!1!==t&&'skip'!==t&&this.downloaded.delete(i[e]),!1!==t&&'skip'!==t&&a&&a[i[e]]&&a[i[e]].id)u.set(i[e],a[i[e]]);else{u.set(i[e],!1);let t=a&&a[i[e]]?a[i[e]]:'';l.set(i[e],t)}}return l};x.tfOn('beforeunload',l).document.tfOn('visibilitychange',o,{passive:!0}),A=((t,e)=>{const a=[];for(;0<t.length;)a.push(t.splice(0,e));return a})(A,I),wp&&wp.heartbeat&&wp.heartbeat.interval(120),i[0]=new Promise(async t=>{for(let t=0,e=A.length;t<e;++t)try{let a=[],i=y(A[t]),l=!1;s+=i.length;for(let e=i.length-1;-1<e;--e){let t=u.get(i[e]);if(!t){l=!0;break}a[e]=t}if(!0===l){if(!(n=!1)===r){s>h&&(s=h);let t=O.createDocumentFragment(),e=O.createElement('div'),a=O.createElement('div');a.className='img_wrap',e.className='msg_text',e.innerHTML=m.replaceAll('%from%',s);for(let e=i.length-1;-1<e;--e){let t=new Image(50,50);t.className='tf_box',t.decoding='async',t.src=i[e];try{await t.decode()}catch(t){}a.appendChild(t)}t.append(e,a),await d.show('info',t)}if(A[t+1]!==M)try{_(A[t+1])}catch(t){}try{a=await this._batchDownload(i,g)}catch(t){}}let o=b(A[t],a);if(!0===r&&0<o.skip.size){let t=[...o.skip].join(', ');await d.showHide('error',p.replaceAll('%post%',t),2e3)}if(!0===l&&0<a.length){delete o.skip;let e;if(!0===r&&''!==f){let t=d.el.shadowRoot.querySelector('.msg_text');t&&(s>h&&(s=h),t.innerHTML=f.replaceAll('%from%',s))}try{n=!0,await new Promise(t=>{setTimeout(async()=>{e=await this._batchUpload(o.formData,g),t()},!0===c?1e3:10)})}catch(t){}let a=v(e,i);if(!0===r&&0<a.size)for(let[t,e]of a)await d.showHide('error',w.replaceAll('%post%',t).replaceAll('%msg%',e),2e3)}}catch(t){}t()}),1<A.length&&(i[1]=new Promise(async t=>{for(let o=A.length-1;-1<o;--o)try{let i=[],e=!1,l=y(A[o]);for(let t=l.length-1;-1<t;--t)if(!u.has(l[t])){e=!0;break}if(!0===e){if(c=!1,A[o-1]!==M)try{_(A[o-1])}catch(t){}try{i=await this._batchDownload(l,g)}catch(t){}c=!0,await new Promise(a=>{setTimeout(async()=>{let t=b(A[o],i),e;if(0<i.length){try{e=await this._batchUpload(t.formData,g)}catch(t){}v(e,l)}s+=l.length,a()},!0===n?1300:10)})}}catch(t){}t()})),this.downloaded.clear(),x.tfOff('beforeunload',l).document.tfOff('visibilitychange',o,{passive:!0}),await Promise.all(i),t(u)})}}})(Themify,document,window.top,void 0);export{ImportImages};