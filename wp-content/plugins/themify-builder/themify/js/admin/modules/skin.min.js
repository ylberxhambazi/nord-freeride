let Skin;((b,e,f)=>{'use strict';const k=new Map;Skin={el:null,skinId:null,importModule(){return b.importJs(b.url+'js/admin/import/import')},notificationModule(){return b.importJs(b.url+'js/admin/notification')},getForm(e){const l=e.labels,r=e.plugins,t=f.createElement('div'),a=f.createElement('div'),i=f.createElement('a'),s=f.createElement('div'),n=f.createElement('p'),o=f.createElement('a'),c=f.createElement('i'),d=f.createDocumentFragment(),m=f.createDocumentFragment(),p=['builder_img'];if(t.className='required-addons themify-modal tf_scrollbar tf_opacity tf_hide',i.className='proceed-import button big-button themify_button',i.textContent=l.proceed_import,a.className='tf_import_wrap',s.className='tf_erase',n.className='note',n.textContent=l.note,o.className='close',o.href='#',c.className='tf_close',o.appendChild(c),0<Object.keys(r).length){let s=!0,n=f.createDocumentFragment();for(let i in r){let e=f.createElement('li'),t=f.createElement('a'),a;if(r[i].page?(t.target='_blank',t.rel='noopener',t.href=r[i].page):t=f.createElement('span'),t.textContent=r[i].name,r[i].error||r[i].active&&1===r[i].active)if(r[i].error){a=f.createElement('div'),e.className='tf_plugin_has_error',a.className='tf_plugin_error',a.innerHTML=r[i].error;let t=a.tfTag('a');for(let e=t.length-1;-1<e;--e)t[e].target='_blank',t[e].rel='noopener';s=!1}else(a=f.createElement('span')).className='ti-check';else{(a=f.createElement('a')).href='#',a.className='tf_install_plugin',a.dataset.type=r[i].install?'install':'activate',s=!1;let e=l.activate;r[i].install&&('buy'===r[i].install?(e=l.buy,a.href=r[i].page,a.target='_blank',a.rel='noopener',a.className='',a.dataset.type='buy'):e=l.install),a.innerHTML=e,a.dataset.plugin=i,a.dataset.name=r[i].name}e.appendChild(t),r[i].error||e.appendChild(f.createTextNode('( ')),e.appendChild(a),r[i].error||e.appendChild(f.createTextNode(' )')),n.appendChild(e)}if(!1===s){const h=f.createElement('p'),u=f.createElement('p'),_=f.createElement('ul');u.textContent=l.head,h.className='themify-import-warning',h.textContent=l.import_warning,_.appendChild(n),d.append(u,_,h)}}e.has_demo&&(p.push('modify'),p.push('erase'));for(let i=p.length-1;-1<i;--i){let e=f.createElement('label'),t=f.createElement('input'),a=f.createElement('span');t.type='checkbox',t.id=e.htmlFor='tf_'+p[i]+'_demo','builder_img'!==p[i]&&(t.checked=!0),a.textContent=l[p[i]],e.appendChild(a),m.append(t,e)}return s.appendChild(m),a.append(i,s),d.append(a,n,o),t.appendChild(d),t},init(s){return new Promise(async(e,t)=>{try{const a=f.querySelector('.required-addons.themify-modal');if(s=s||{},this.skinId=s.skin||'default',!a||a.dataset.skin!==s.skin){a&&a.remove(),this.el&&this.el.remove(),s.action='themify_required_plugins_modal',s.nonce=themify_js_vars.nonce;const i=await b.fetch(s);if(!i.success)throw i.data;this.el=this.getForm(i.data),themify_js_vars.labels=i.data.labels;let d=[],m=!1;this.el.tfOn('click',async e=>{const t=e.target?e.target.closest('.proceed-import,.close,.tf_install_plugin'):null;if(t&&'_blank'!==t.target){e.preventDefault();const a=t.classList;if(!a.contains('disabled'))if(a.contains('proceed-import')){a.add('disabled');const i=!!this.el.querySelector('#tf_erase_demo:checked'),s=!!this.el.querySelector('#tf_modify_demo:checked'),n=!!this.el.querySelector('#tf_builder_img_demo:checked'),l=this.el.tfClass('tf_install_plugin');for(let e=l.length-1;-1<e;--e)l[e].classList.add('disabled');try{await this.import(i,s,n),await this.close(),window.location.reload()}catch(e){for(let e=l.length-1;-1<e;--e)l[e].classList.remove('disabled');a.remove('disabled')}}else if(a.contains('tf_install_plugin')){a.add('disabled');const r=f.createElement('span'),o=this.el.tfClass('proceed-import')[0].classList,c=async t=>{try{await this.installPlugins(t),t.tfClass('tf_loader')[0].className='ti-check'}catch(e){t.innerHTML=themify_js_vars.labels[t.dataset.type],t.classList.remove('disabled')}};if(o.add('disabled'),r.className='tf_loader',t.innerHTML='',t.appendChild(r),!0===m)d.push(t);else{m=!0,await c(t);for(let e=0,t=d.length;e<t;++e)await c(d[e]);d=[],m=!1,o.remove('disabled')}}else this.close()}}),f.tfId('themify').appendChild(this.el)}this.show(),e(a?'open':'ajax')}catch(e){t(e)}})},show(){return new Promise(e=>{this.el.classList.remove('tf_hide'),setTimeout(()=>{this.el.tfOn('transitionend',e,{passive:!0,once:!0}).classList.remove('tf_opacity')},100)})},close(){return new Promise(t=>{this.el.tfOn('transitionend',e=>{this.el.classList.add('tf_hide'),this.el.remove(),t()},{passive:!0,once:!0}).classList.add('tf_opacity')})},installPlugins(d){return new Promise(async(t,a)=>{const s=(await this.notificationModule()).Notification,n=themify_js_vars,l=d.dataset.type,r=d.dataset.name,i=async()=>{const t=await b.fetch({action:'themify_activate_plugin',plugin:d.dataset.plugin,nonce:n.nonce});if(!t.success){let e=t.data;if(e.check_license||e.buy){if(e.check_license){const i=(await b.importJs(b.url+'js/admin/modules/license')).License;await i.init()}const a=Error(e.errorMessage);a.code=e.buy?'buy':'check_license',e.buy&&(d.dataset.type='buy',d.target='_blank',d.rel='noopener',d.href=e.url),e=a}else e.errorMessage&&(e=e.errorMessage+':'+e.errorCode);throw e}t.data&&t.data.install_plugin_url&&await b.fetch(null,'text',{method:'GET'},t.data.install_plugin_url),await s.showHide('done',n.labels.plugins[l+'_done'].replaceAll('%plugin%',r),1500),'install'===l&&(d.dataset.type='activate',await this.installPlugins(d))};await s.show('info',n.labels.plugins[l].replaceAll('%plugin%',r));try{try{await i()}catch(e){if(e){if('check_license'===e.code||'buy'===e.code)throw e.message;if(e.install_updater){{const o=(await b.importJs(b.url+'js/admin/modules/install-updater')).Install_Updater;await o(n.nonce)}await 0;try{return await i(),void t()}catch(e){if('check_license'===e.code||'buy'===e.code)throw e.message}}}await new Promise((e,t)=>{setTimeout(()=>{i().then(e).catch(t)},1e3)})}t()}catch(e){const c='string'==typeof e?e:'';await s.showHide('error',n.labels.plugins[l+'_fail'].replaceAll('%plugin%',r).replaceAll('%error%',c),4e3),a(e)}})},import(g,y,w){return new Promise(async(a,t)=>{const i=themify_js_vars;let s='https://themify.me/public-api/samples/'+i.theme+'/',e=this.skinId,n=i.theme+'-'+e;e&&(s+=e+'/'),s+='data.json';try{let e=k.get(s),t=[];e?t.push(e):t.push(b.fetch('',null,{credentials:'omit',method:'GET',mode:'cors',headers:{'Content-Type':'application/json'}},s)),t.push(this.notificationModule()),t.push(this.importModule()),g&&t.push(b.trigger('themify_erase_content',y));const l=await Promise.all(t),r=l[0],o=l[1].Notification,c=l[2].Import,d=i.import,m=parseInt(d.memory)||64,p={data:{},id:n,nonce:i.nonce,action:'themify_import_theme_data'},h=['themify_settings','widgets','homepage'],u=async t=>{try{const e=await b.fetch(t);if(!e.success)throw'error'}catch(e){try{t.data=new Blob([JSON.stringify(t.data)],{type:'application/json'});const a=await b.fetch(t);if(!a.success)throw'error'}catch(e){throw e}}};k.set(s,r),d.images_chunk=255<=m?6:120<=m?5:60<m?3:2,c.importImages(),(r.menu_locations||r.theme_mods||r.product_attribute)&&(await o.show('info',d.menu),r.menu&&(p.data.menu=r.menu),r.menu_locations&&(p.data.menu_locations=r.menu_locations),r.theme_mods&&(p.data.theme_mods=r.theme_mods),r.product_filter&&(p.data.product_filter=r.product_filter),r.product_attribute&&(p.data.product_attribute=r.product_attribute),await u(p),delete p.data.menu,delete p.data.product_filter,delete p.data.menu_locations,delete p.data.product_attribute,delete p.data.theme_mods),w||(d.skip_builder=!0),r.terms&&(d.loading=d.terms,r.terms=c.sort(r.terms,'parent'),await c.init(r.terms,'themify_import_terms',i.nonce,d,n)),r.posts&&(d.loading=d.posts,r.posts=c.sort(r.posts,'post_parent'),await c.init(r.posts,'themify_import_posts',i.nonce,d,n)),r.menu_items&&(d.loading=d.menu_items,r.menu_items=c.sort(r.menu_items,'meta_input','_menu_item_menu_item_parent'),await c.init(r.menu_items,'themify_import_posts',i.nonce,d,n));for(let e=h.length-1;-1<e;--e)void 0!==r[h[e]]&&(p.data[h[e]]=r[h[e]]);0<Object.keys(p.data).length&&(await o.show('info',d.theme),await u(p)),await o.showHide('done',d.done,2e3),a()}catch(e){const _=(await this.notificationModule()).Notification,f='string'==typeof e?e:'';await _.showHide('error',f,2e3),t(e)}})}}})(Themify,0,document);export{Skin};