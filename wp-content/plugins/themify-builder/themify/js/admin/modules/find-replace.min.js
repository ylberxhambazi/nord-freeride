let Replace;((u,e)=>{'use strict';let s=null,d=0,p=100,g;const y=new Map,_=()=>u.importJs(u.url+'js/admin/notification'),m=async(t,e,a,i)=>{const n=y.get(e);if(n)return n;const o=await u.fetch({action:'tb_get_ajax_builder_posts',page:e,nonce:t});if(o.success)return y.set(e,o.data),!i&&e+1<=a&&m(t,e+1,a,1),o.data;throw o.data},r=(a,i,n)=>{for(let e in n)if('element_id'!==e&&'mod_name'!==e&&!0!==n[e]&&'px'!==n[e]&&'%'!==n[e]&&n[e]&&isNaN(n[e]))if(Array.isArray(n[e])||'object'==typeof n[e])r(a,i,n[e]);else if('string'==typeof n[e]){let t=n[e].toString().trim();-1!==t.indexOf(a)&&(s=!0,n[e]=t.replaceAll(a,i))}return n},b=async(a,i,n,t)=>{d+=n.length;const o=[],e=(await _()).Notification;await e.show('info',j(g.searching,a,n,d,t),1200);for(let e=n.length-1;-1<e;--e){s=!1;let t=r(a,i,n[e].data);!0===s&&o.push({data:t,title:n[e].title,id:n[e].id})}return o},a=t=>(t.preventDefault(),t.returnValue='Are you sure'),l=a=>{const i=[];for(let e in a){let t=a[e].title||a[e];i.push(t)}return i.join(', ')},j=(e,t,a,i,n)=>{const o={posts:a?l(a):'',total:n,count:i,find:t};for(let t in o)void 0!==o[t]&&(e=e.replaceAll('%'+t+'%',o[t]));return e=140<e.length?e.slice(0,140)+'...':e},x=async e=>{try{if('/'!==e[0]&&'/'!==e[1]){if(0!==e.indexOf('http'))throw'';'http://'!==e&&'https://'!==e&&new URL(e)}}catch(t){throw g.wrong_url.replaceAll('%url%',e)}},O=(i,n)=>new Promise((e,a)=>{setTimeout(()=>{const t={action:'tb_save_ajax_builder_mutiple_posts',nonce:n,data:i};u.fetch(t).then(t=>{if(!t.success)return a(t.data);e(t)}).catch(a)},p)});Replace=async(o,i,s)=>{const r=(await _()).Notification;try{e.tfOff('beforeunload',a).tfOn('beforeunload',a),d=0,y.clear();const t=await m(s,1,0),n=t.pages,l=t.total;if(g=t.labels,o===i)throw g.same_url;await Promise.all([x(o),x(i)]);const c=await b(o,i,t.posts,l);for(let a=2;a<=n;++a)try{let t=await m(s,a,n),e=await b(o,i,t.posts,l);c.push(...e)}catch(t){}if(0<c.length){12<c.length&&(p=150),await r.show('info',j(g.found,o,c,c.length,l),3e3);const f=[],h=[],w=c.length;let i=!1,n=0;for(;0<c.length;){let a=c.splice(0,5),i={},n={};for(let e=a.length-1;-1<e;--e){let t=a[e].id;i[t]=a[e].data,n[t]=a[e].title}f.push(i),h.push(n)}for(let e=0,t=f.length;e<t;e++){n+=Object.keys(h[e]).length,await r.show('info',j(g.saving,o,h[e],n,w));let a;try{if(!(a=await O(f[e],s)).success)throw a.data}catch(t){try{if(!(a=await O(new Blob([JSON.stringify(f[e])],{type:'application/json'}),s)).success)throw a.data}catch(t){await r.showHide('error',t,2e3)}}if(a&&a.data){a=a.data;let e=[];for(let t in a)1!=a[t]?e.push(a[t]):i=!0;0<e.length&&await r.showHide('error',j(g.no_found,o,e,e.length,l),4e3)}}!0===i&&await u.fetch({action:'themify_regenerate_css_files_ajax',nonce:s}),await r.showHide('done',g.done)}else await r.showHide('warning',j(g.no_found,o),3e3)}catch(t){await r.showHide('error',t)}e.tfOff('beforeunload',a)}})(Themify,window);export{Replace};