((i,e)=>{'use strict';let l,t=null,a=null,s=null,n=i.h,o=null;const r='builder-parallax-scrolling',d=new Set,h=new Set,c=e=>{const t=tbLocalScript.breakpoints;let l='desktop';return e<=t.mobile?l='mobile':e<=t.tablet[1]?l='tablet':e<=t.tablet_landscape[1]&&(l='tablet_landscape'),l},u=()=>{requestAnimationFrame(()=>{for(let e of d)e&&e.el&&e.el.isConnected?e.el.classList.contains(r)&&e.update():e&&e.destroy()})},p=t=>{t&&(n=t.h,o&&clearTimeout(o),o=setTimeout(()=>{s&&cancelAnimationFrame(s),s=requestAnimationFrame(()=>{const e=c(t.w);for(let t of d)t&&t.el&&t.el.isConnected?l!==e?t.isInBreakpoint()?t.getImage().then(()=>{t.update()}).catch(e=>{t&&t.destroy()}):(h.add(t),t&&t.destroy()):t.update():t&&t.destroy();if(l!==e){l=e;for(let e of h)e.el.isConnected?e.isInBreakpoint()&&(e.init(),h.delete(e)):h.delete(e)}s=o=null})},20))};class g{constructor(e){i.is_builder_active||e.removeAttribute('data-parallax-bg'),this.el=e,this.isInBreakpoint()?this.init():(e.classList.remove(r),h.add(this)),null===a&&(a=!0,i.on('tfsmartresize',p))}init(){null===t&&(t=!0,e.tfOn('scroll',u,{passive:!0})),this.getImage().then(()=>{this.el.classList.add(r),d.add(this),this.update()}).catch(e=>{})}isInBreakpoint(){return'parallax'===getComputedStyle(this.el).getPropertyValue('--tbBg')}getImage(){return new Promise((e,t)=>{let l=getComputedStyle(this.el).getPropertyValue('background-image');if(l&&'none'!==l&&'initial'!==l&&'unset'!==l){if(l=l.replace(/(url\(|\)|")/g,''),/\.(jpg|jpeg|png|webp|avif|gif|svg|apng)$/.test(l)){const i=new Image;i.src=l,i.decode().then(()=>{this.w=i.width,this.h=i.height,e()}).catch(e=>{console.error('Parrallax('+l+'): '+e),t()})}}else t()})}destroy(){d.delete(this),this.el.classList.remove(r),this.el.style.backgroundSize=this.el.style.backgroundPositionY='',0===d.size&&(0===h.size&&(i.off('tfsmartresize',p),a=null),e.tfOff('scroll',u,{passive:!0}),t=null)}update(){const e=this.el.ownerDocument.defaultView.scrollY,l=(e=>{const t=e.getBoundingClientRect();return{top:t.top+e.ownerDocument.defaultView.scrollY,w:t.width,h:t.height}})(this.el),t=l.top,i=l.h,a=.1*(t-e);if(!(t+i<e||t>e+n)){this.el.style.backgroundPositionY='calc(50% + '+Math.round(a)+'px)';const s=Math.max(l.w/this.w,i/this.h);let e=Math.round(this.w*s),t=Math.round(this.h*s);t===Math.round(i)?(e*=1.3,t*=1.3,this.el.style.backgroundSize=Math.round(e)+'px '+Math.round(t)+'px'):this.el.style.backgroundSize=''}}}l=c(i.w),i.on('builder_load_module_partial',(e,t)=>{let l;if(!0===t){if(!e.hasAttribute('data-parallax-bg'))return;l=[e]}else l=i.selectWithParent('[data-parallax-bg]',e);for(let e=l.length-1;-1<e;--e)new g(l[e])})})(Themify,window);