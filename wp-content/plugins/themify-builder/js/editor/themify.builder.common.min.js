'use strict';var ThemifyBuilderCommon;
(function(p,w,h,y){h!==window.self&&(window.wp.shortcode=h.wp.shortcode);ThemifyBuilderCommon={loader:null,showLoader(a){null===this.loader&&(this.loader=p(h.document.getElementById("tb_alert")));const b=this.loader[0];"show"===a?(b.classList.add("tb_busy"),b.style.display="block"):"spinhide"===a?this.loader.fadeOut(300,function(){this.classList.remove("tb_busy")}):("error"!==a&&(a="done"),b.classList.remove("tb_busy"),b.classList.add("tb_"+a),this.loader.delay(500).fadeOut(500,function(){this.classList.remove("tb_"+
a)}))},clone(a){if(null===a)return a;void 0!==a[0]&&(a=a[0]);a=a.cloneNode(!0);p(a).find("#tb_component_bar").empty().attr("id","").closest(".tb_clicked").removeClass("tb_clicked");if("visual"===tb_app.mode){var b=a.getElementsByTagName("video");if(0<b.length){for(let d=b.length-1;-1<d;--d)b[d].pause();for(let d=a.getElementsByClassName("big-video-wrap"),c=d.length-1;-1<c;--c)d[c]&&d[c].remove()}for(let d=a.getElementsByClassName("tb_dragger"),c=d.length-1;-1<c;--c)d[c].remove();for(let d=w.selectWithParent("tb_element_clicked",
a),c=d.length-1;-1<c;--c)d[c].classList.remove("tb_element_clicked");for(let d=w.selectWithParent("[contenteditable]",a),c=d.length-1;-1<c;--c)d[c].setAttribute("contenteditable","false"),(b=d[c].closest(".tb_editor_on"))&&b.classList.remove("tb_editor_on","tb_editor_clicked")}return p(a)},Clipboard:{key:"themify_builder_clipboard_",set(a,b){const d={};d[a]=b;localStorage.setItem(this.key+"content",JSON.stringify(d))},get(a){const b=JSON.parse(localStorage.getItem(this.key+"content"));return void 0!==
b[a]?b[a]:!1}},alertWrongPaste(){alert(themifyBuilder.i18n.text_alert_wrong_paste)},autoComplete(a){var b=p(".themify_tax_autocomplete",a);if(0<b.length){var d=[];b.each(function(){var c=p(this),m=c.closest(".tb_input").find("input.query_category_multiple"),n=m.val();p(this).autocomplete({minLength:2,source(e,f){e=p.trim(e.term);p.getJSON(themifyBuilder.ajaxurl,{term:p.trim(e),tax:c.data("tax"),action:c.data("action")},function(k,t,D){f(k)})},select(e,f){m.val(f.item.value);this.value=f.item.label;
return!1}}).focus(function(){p(this).autocomplete("search");return!1});if(n&&"undefined"!==n){var g={};g[c.data("tax")]=n;d.push(g)}else m.val("")});0<d.length&&p.ajax({url:themifyBuilder.ajaxurl,type:"POST",dataType:"json",data:{data:d,action:"themify_builder_get_tax_data"},success(c){if(c)for(var m in c)p("#themify_search_cat_"+c[m].tax,a).val(c[m].val)}})}},Lightbox:{$lightbox:null,lightboxStorageKey:h!==window.self?"themify_builder_lightbox_frontend_pos_size":"themify_builder_lightbox_backend_pos_size",
setup(){h.document.body.appendChild(y.getElementById("tmpl-builder_lightbox").content);this.$lightbox=p("#tb_lightbox_parent",h.document);ThemifyBuilderCommon.LiteLightbox.modal=new wp.media.view.Modal({controller:{trigger(){}}});ThemifyBuilderCommon.LiteLightbox.modal.on("attach",function(){this.el.classList.add("tb_lite_lightbox_modal")});this.bindEvents()},bindEvents(){const a=this;a.responsiveTabs();a.$lightbox.one("themify_opened_lightbox",function(){a.resizable.init();"visual"===tb_app.mode&&
a.$lightbox[0].getElementsByClassName("builder_cancel_docked_mode")[0].addEventListener("click",function(b){b.preventDefault();b.stopPropagation();b=this.ownerDocument.body.classList;b.add("themify_lightbox_drag");ThemifyBuilderCommon.Lightbox.dockMode.close();b.remove("themify_lightbox_drag")});a.$lightbox[0].getElementsByClassName("tb_close_lightbox")[0].addEventListener("click",function(){a.close()},{passive:!0})});themifyBuilder.disableShortcuts||a.controlByKeyInput()},getLightboxStorage(){const a=
localStorage.getItem(this.lightboxStorageKey);return a?JSON.parse(a):{}},updateLightboxStorage(a){localStorage.setItem(this.lightboxStorageKey,JSON.stringify(Object.assign(this.getLightboxStorage(),a)))},resizable:{$el:null,init(){const a=this,b=tb_app.Utils.getMouseEvents(),d=ThemifyBuilderCommon.Lightbox,c=h.document.body.classList;this.$el=d.$lightbox;var m=this.$el[0].getElementsByClassName("tb_resizable");const n=this.$el[0].querySelectorAll(".tb_lightbox_top_bar,.tb_action_breadcrumb");for(let g=
m.length-1;-1<g;--g)m[g].addEventListener(b.mousedown,function(e){if("touchstart"===e.type||1===e.which){e.stopImmediatePropagation();let f;const k=this.ownerDocument,t=parseInt(a.$el.css("min-height")),D=.9*k.documentElement.clientHeight,l=this.dataset.axis,A=parseInt(a.$el[0].offsetHeight,10),B=parseInt(a.$el[0].offsetWidth,10),C=e.touches?e.touches[0].clientX:e.clientX,r=e.touches?e.touches[0].clientY:e.clientY,z=function(v){v.stopImmediatePropagation();f&&cancelAnimationFrame(f);f=requestAnimationFrame(function(){const u=
a.$el[0];var q=v.touches?v.touches[0].clientX:v.clientX;var x=v.touches?v.touches[0].clientY:v.clientY;if("w"===l)q=C+B-q,880<q&&(q=880),350<=q&&880>=q&&(x=u.style.width,u.style.width=q+"px",u.style.left=parseInt(u.style.left)+parseInt(x)-q+"px",a.setupLightboxSizeClass(q));else{x="-y"===l||"ne"===l||"nw"===l?r+A-x:A+x-r;q="sw"===l||"nw"===l?C+B-q:B+q-C;880<q&&(q=880);if(("se"===l||"x"===l||"sw"===l||"nw"===l||"ne"===l)&&350<=q&&880>=q){const E=u.style.width;u.style.width=q+"px";if("sw"===l||"nw"===
l)u.style.left=parseInt(u.style.left)+parseInt(E)-q+"px";a.setupLightboxSizeClass(q)}if(("se"===l||"y"===l||"-y"===l||"sw"===l||"nw"===l||"ne"===l)&&x>=t&&x<=D){if("-y"===l||"nw"===l||"ne"===l)u.style.top=parseInt(u.style.top)+parseInt(u.style.height)-x+"px";u.style.height=x+"px"}}w.body.triggerHandler("themify_builder_resize_lightbox")})};k.addEventListener(b.mousemove,z,{passive:!0});k.addEventListener(b.mouseup,function(v){v.stopImmediatePropagation();this.removeEventListener(b.mousemove,z,{passive:!0});
f&&cancelAnimationFrame(f);f=null;d.fixContainment();a.remember();this.body.style.cursor="";c.remove("tb_start_animate","tb_move_drag","tb_panel_resize")},{passive:!0,once:!0});c.add("tb_start_animate","tb_move_drag","tb_panel_resize");"se"!==l&&"x"!==l&&"sw"!==l&&"ne"!==l&&"nw"!==l||a.setupLightboxSizeClass();k.body.style.cursor=p(this).css("cursor")}},{passive:!0});for(m=n.length-1;-1<m;--m)n[m].addEventListener(b.mousedown,function(g){if("touchstart"===g.type||1===g.which){const C=d.dockMode.get()&&
!c.contains("tb_standalone_lightbox")&&(this.classList.contains("tb_action_breadcrumb")||g.target.classList.contains("tb_lightbox_top_bar"));if(C||g.target.classList.contains("tb_lightbox_top_bar")){g.stopImmediatePropagation();var e,f,k=a.$el[0],t=this.ownerDocument,D=k.offsetLeft-(g.touches?g.touches[0].clientX:g.clientX),l=k.offsetTop-(g.touches?g.touches[0].clientY:g.clientY),A=function(r){r.stopImmediatePropagation();e&&cancelAnimationFrame(e);e=requestAnimationFrame(function(){const z=D+(r.touches?
r.touches[0].clientX:r.clientX),v=l+(r.touches?r.touches[0].clientY:r.clientY);k.style.left=z+"px";k.style.top=v+"px";d.dockMode.drag(r,z)})},B=function(r){f=!0;r.stopImmediatePropagation();if(C){r=k.offsetLeft;const z=k.offsetTop;k.getElementsByClassName("builder_cancel_docked_mode")[0].click();k.style.left=r+"px";k.style.top=z+"px"}c.add("tb_start_animate","tb_move_drag","themify_lightbox_drag")};t.addEventListener(b.mouseup,function(r){this.removeEventListener(b.mousemove,B,{passive:!0,once:!0});
this.removeEventListener(b.mousemove,A,{passive:!0});f&&(A(r),requestAnimationFrame(function(){e=k=f=null;d.fixContainment();c.remove("tb_start_animate","tb_move_drag","themify_lightbox_drag")}),a.remember())},{passive:!0,once:!0});t.addEventListener(b.mousemove,B,{passive:!0,once:!0});t.addEventListener(b.mousemove,A,{passive:!0})}}},{passive:!0});a.setupLightboxSizeClass()},remember(){if(!h.document.body.classList.contains("tb_standalone_lightbox")){var a=ThemifyBuilderCommon.Lightbox.resizable;
const b=a.$el.position();a={top:b.top,left:b.left,width:a.$el.outerWidth(),height:a.$el.outerHeight()};ThemifyBuilderCommon.Lightbox.updateLightboxStorage(a);w.body.triggerHandler("themify_builder_resize_lightbox")}},setupLightboxSizeClass(a){if(null!==this.$el){a||(a=parseInt(this.$el.width()));const b=this.$el[0].classList;750<a?b.add("larger-lightbox"):b.remove("larger-lightbox");540>a?b.add("tb_lightbox_small"):b.remove("tb_lightbox_small")}}},fixContainment(){var a=this.$lightbox[0].getBoundingClientRect();
const b=a.width,d=h.innerWidth-20,c=h.innerHeight-30,m=a.left;a=a.top;const n={};0>m?n.left=20:m+b>d&&(n.left=d-b);0>a?n.top=0:a>c&&(n.top=c);for(let g in n)this.$lightbox[0].style[g]=n[g]+"px"},setStandAlone(a,b,d){const c=this.$lightbox.outerWidth(),m=this.$lightbox.outerHeight(),n=h.document.documentElement.clientWidth,g=h.document.documentElement.clientHeight;d||"visual"!==tb_app.mode||(this.dockMode.get()&&(tb_app.toolbar.$el.find(".tb_toolbar_add_modules").click(),h.document.body.classList.contains("tb_panel_minimized")||
("desktop"!==tb_app.activeBreakPoint?a+=this.dockMode.isLeft?150:-150:this.dockMode.isLeft&&(a+=300))),"desktop"!==tb_app.activeBreakPoint&&(a+=(n-tb_app.iframe.width())/2+8));a-=c/2;5>=a?a=5:a+c>n&&(a=n-c-20);b+=50;b+m>g&&(b=g-m-5);0>b&&(b=5);this.$lightbox.css({left:a,top:b}).one("themify_opened_lightbox",function(){tb_app.Utils.addViewPortClass(this)})},open(a,b,d){const c=ThemifyBuilderCommon.Lightbox,m=h.document,n=c.$lightbox[0].querySelector("#tb_lightbox_container"),g=function(e){c.$lightbox[0].style.display=
"none";for("function"===typeof b&&b.call(c,e);null!==n.firstChild;)n.removeChild(n.firstChild);"string"===typeof e?n.innerHTML=e:n.appendChild(e);e=m.body.classList.contains("tb_standalone_lightbox");var f=null;if(!1===e){var k={top:100,left:Math.max(0,p(h).width()/2-300),width:600,height:500};Object.assign(k,c.getLightboxStorage())}else k={top:"",left:"",width:"",height:""};for(var t in k)c.$lightbox[0].style[t]=""!==k[t]?k[t]+"px":"";!1===e&&(!0===c.dockMode.get()?(c.dockMode.setDoc(),f=!0):c.fixContainment());
"function"===typeof d&&d.call(c,n);null===f&&c.resizable.setupLightboxSizeClass(k.width);c.$lightbox[0].style.display="block";c.$lightbox.triggerHandler("themify_opened_lightbox");if("inline"!==a.loadMethod)for(t=n.getElementsByClassName("tb_tabs"),e=t.length-1;-1<e;--e)for(k=t[e].getElementsByTagName("a"),f=k.length-1;-1<f;--f)k[f].addEventListener("click",ThemifyConstructor.switchTabs);tb_app.Instances.Builder[tb_app.builderIndex].lastRowShowHide()};"inline"===a.loadMethod?(w.body.triggerHandler("themify_builder_lightbox_close"),
m.body.classList.remove("tb_standalone_lightbox"),g(ThemifyConstructor.run(a.templateID))):"html"===a.loadMethod?(tb_app.autoSaveCid=null,c.close(!0),!0===a.contructor?g(ThemifyConstructor.run(a.data,a.save)):g(a.data)):(ThemifyBuilderCommon.showLoader("show"),tb_app.autoSaveCid=null,c.close(!0),a.data.nonce=themifyBuilder.tb_load_nonce,a=_.defaults(a||{},{type:"POST",url:themifyBuilder.ajaxurl}),p.ajax(a).done(function(e){!0===a.contructor?g(ThemifyConstructor.run(e)):g(e);ThemifyBuilderCommon.showLoader("spinhide")}))},
close(a){const b=ThemifyBuilderCommon.Lightbox;w.body.triggerHandler("themify_builder_lightbox_before_close");"visual"===tb_app.mode&&h.jQuery("body").trigger("themify_builder_lightbox_close",a);a||(b.$lightbox[0].style.display="none",tb_app.autoSaveCid=null);b._cleanLightBoxContent();a||(tb_app.undoManager.updateUndoBtns(),tb_app.Instances.Builder[tb_app.builderIndex].lastRowShowHide(!0),tb_app.Utils.removeViewPortClass(b.$lightbox[0]));tb_app.ActionBar.hoverCid=null;tb_app.ActionBar.clearSelected();
w.body.triggerHandler("themify_builder_lightbox_close",a)},dockMode:{key:"themify_builder_docked",leftKey:"themify_builder_docked_left",workspace:h.document.body.getElementsByClassName("tb_workspace_container")[0],minEl:null,width:322,isDocked:null,isLeft:null,set(a){(this.isDocked=a)?(localStorage.setItem(this.key,a),this.isLeft?localStorage.setItem(this.leftKey,!0):localStorage.removeItem(this.leftKey)):(localStorage.removeItem(this.key),localStorage.removeItem(this.leftKey));w.body.triggerHandler("themify_builder_resize_lightbox")},
get(){return"visual"===tb_app.mode&&(null===this.isDocked&&(this.isDocked="true"===localStorage.getItem(this.key)),!0===this.isDocked)?(this.isLeft="true"===localStorage.getItem(this.leftKey),!0):!1},minimize(a){a.stopPropagation();a=h.document.body.classList;a.contains("tb_panel_minimized")?a.remove("tb_panel_minimized"):a.add("tb_panel_minimized");tb_app.Utils._onResize(!0)},setDoc(){null===tb_app.toolbar.getStorage()&&localStorage.setItem(this.key,!0);if(this.get()){const a=h.document.body.classList,
b=tb_app;a.contains("tb_panel_docked")?ThemifyBuilderCommon.Lightbox.resizable.setupLightboxSizeClass(this.width):(a.add("tb_panel_docked"),this.isLeft?(a.add("tb_panel_left_dock"),a.remove("tb_panel_right_dock")):(a.add("tb_panel_right_dock"),a.remove("tb_panel_left_dock")),b.Utils._onResize(!0),ThemifyBuilderCommon.Lightbox.resizable.setupLightboxSizeClass(this.width),w.body.triggerHandler("themify_builder_resize_lightbox"),this.minEl=tb_app.toolbar.el.getElementsByClassName("tb_docked_minimize")[0],
this.minEl.addEventListener("click",this.minimize,{passive:!0}),b.Views.Toolbar.prototype.removeFloat(),b.Views.Toolbar.prototype.openFloat(),b.Views.Toolbar.prototype._setResponsiveTabs())}},drag(a,b){if("visual"===tb_app.mode&&!this.get()){const d=h.document.body.classList;if(!d.contains("tb_standalone_lightbox")){const c=a.clientX+20>=h.innerWidth;a=a.type;this.isLeft=!c&&0>b;!c&&!this.isLeft||"mousemove"!==a&&"touchmove"!==a?d.remove("tb_dock_highlight","tb_dock_left_highlight"):(d.add("tb_dock_highlight"),
this.isLeft?d.add("tb_dock_left_highlight"):d.remove("tb_dock_left_highlight"));!c&&!this.isLeft||"mouseup"!==a&&"touchend"!==a||(this.set(!0),this.setDoc())}}},close(a){if("visual"===tb_app.mode&&this.get()){const d=ThemifyBuilderCommon.Lightbox,c=h.document.body.classList;var b=d.getLightboxStorage();b={width:b.width?b.width:d.resizable.minWidth,height:b.height?b.height:d.resizable.minHeight,top:h.innerHeight/2-d.$lightbox.innerHeight()/2,left:h.innerWidth/2-d.$lightbox.innerWidth()/2};d.$lightbox.css(b);
a&&h.document.body.classList.contains("tb_panel_closed")&&tb_app.Views.Toolbar.prototype.openFloat();if(this.isLeft||!a)a?this.isLeft?c.remove("tb_panel_right_dock"):c.remove("tb_panel_left_dock"):(c.remove("tb_panel_left_dock","tb_panel_right_dock","tb_panel_docked"),null!==this.minEl&&(this.minEl.removeEventListener("click",this.minimize,{passive:!0}),this.minEl=null),null!==tb_app.activeModel&&localStorage.getItem("tb_panel_closed")&&tb_app.Views.Toolbar.prototype.closeFloat(),tb_app.Views.Toolbar.prototype.setFloat(),
c.contains("tb_standalone_lightbox")||this.set(null));d.resizable.setupLightboxSizeClass(b.width);tb_app.Utils._onResize(!0)}}},_cleanLightBoxContent(){let a=this.$lightbox.find("#tb_lightbox_container")[0];for(;null!==a.firstChild;)a.removeChild(a.firstChild);for(a=this.$lightbox[0].getElementsByClassName("tb_options_tab")[0];null!==a.firstChild;)a.removeChild(a.firstChild);for(a=this.$lightbox[0].getElementsByClassName("tb_lightbox_actions_wrap")[0];null!==a.firstChild;)a.removeChild(a.firstChild);
for(a=this.$lightbox[0].getElementsByClassName("tb_action_breadcrumb")[0];null!==a.firstChild;)a.removeChild(a.firstChild)},controlByKeyInput(){function a(b){if(27===b.keyCode&&tb_app.activeModel)b.preventDefault(),b.stopPropagation(),ThemifyBuilderCommon.Lightbox.close();else if(83===b.which&&(!0===b.ctrlKey||!0===b.metaKey)&&"INPUT"!==h.document.activeElement.tagName&&"TEXTAREA"!==h.document.activeElement.tagName){b.preventDefault();b.stopPropagation();b=tb_app.activeModel?p(".builder_save_button",
ThemifyBuilderCommon.Lightbox.$lightbox):null;if(null===b||0===b.length)b=tb_app.toolbar.$el.find(".tb_toolbar_save");b.click()}}p(y).on("keydown.tb_shortcut",a);if("visual"===tb_app.mode)p(h.document).on("keydown.tb_shortcut",a)},responsiveTabs(){var a=null,b,d,c=null,m=function(n,g,e){setTimeout(function(){if("styling"===ThemifyConstructor.clicked){a:{var f=null===a?h.document.getElementById("tb_options_styling"):null;null===a&&(a=f.getElementsByClassName("tb_tabs")[0]);if(void 0!==a){if(!d)if(b=
a.getElementsByTagName("ul")[0],void 0!==b)if(f=b.getElementsByTagName("li"),f=f[f.length-1],f=p(f),a=p(a),"rtl"===y.dir){const k=f.outerWidth(),t=h.innerWidth;d=t-(f.offset().left+k)+k-(t-(a.offset().left+a.outerWidth()))}else d=f.offset().left+f.outerWidth()-a.offset().left;else break a;a.innerWidth()<=d?(a[0].classList.add("tb_compact_tabs"),b.classList.add("tb_ui_dropdown_items"),null===c&&(c=y.createElement("span"),c.className="tb_ui_dropdown_label",c.tabIndex="-1",c.textContent=b.getElementsByClassName("current")[0].textContent,
b.parentNode.insertBefore(c,b))):(a[0].classList.remove("tb_compact_tabs"),b.classList.remove("tb_ui_dropdown_items"))}}"themify_builder_tabsactive"===n.type&&null!==c&&(c.textContent=b.getElementsByClassName("current")[0].textContent)}},4)};w.body.on("themify_builder_tabsactive themify_builder_resize_lightbox",m).on("themify_builder_lightbox_close",function(){a=b=d=c=null});this.$lightbox.on("themify_opened_lightbox",m)}},LiteLightbox:{modal:null,confirmView:Backbone.View.extend({template:wp.template("builder_lite_lightbox_confirm"),
className:"tb_lite_lightbox_content",initialize(a){this.options=a||{}},render(){this.el.innerHTML=this.template({message:this.options.message,buttons:this.options.buttons})},events:{"click button":"buttonClick"},buttonClick(a){a.preventDefault();this.trigger("litelightbox:confirm",p(a.currentTarget).data("type"))}}),promptView:Backbone.View.extend({template:wp.template("builder_lite_lightbox_prompt"),className:"tb_lite_lightbox_content",initialize(a){this.options=a||{}},render(){this.$el.html(this.template(this.options))},
events:{"click button":"buttonClick","keypress .tb_litelightbox_prompt_input":"keyPress"},buttonClick(a){a.preventDefault();this.trigger("litelightbox:prompt",p(a.currentTarget).data("type"),this.$el.find(".tb_litelightbox_prompt_input").val())},keyPress(a){13===a.which&&this.trigger("litelightbox:prompt","ok",p(a.currentTarget).val())}}),confirm(a,b,d){d=_.defaults(d||{},{buttons:{no:{label:"No"},yes:{label:"Yes"}}});d.message=a;a=new ThemifyBuilderCommon.LiteLightbox.confirmView(d);ThemifyBuilderCommon.LiteLightbox.modal.content(a);
ThemifyBuilderCommon.LiteLightbox.modal.open();a.on("litelightbox:confirm",function(c){ThemifyBuilderCommon.LiteLightbox.modal.close();"function"===typeof b&&b.call(this,c)})},prompt(a,b,d){d=_.defaults(d||{},{buttons:{cancel:{label:"Cancel"},ok:{label:"OK"}}});d.message=a;a=new ThemifyBuilderCommon.LiteLightbox.promptView(d);ThemifyBuilderCommon.LiteLightbox.modal.content(a);ThemifyBuilderCommon.LiteLightbox.modal.open();a.on("litelightbox:prompt",function(c,m){ThemifyBuilderCommon.LiteLightbox.modal.close();
"function"===typeof b&&b.call(this,"cancel"===c?null:m)})},alert(a){ThemifyBuilderCommon.LiteLightbox.confirm(a,null,{buttons:{yes:{label:"OK"}}})}},templateCache:{templates:[],get(a){if(void 0===this.templates[a]){const b=y.getElementById(a);this.templates[a]=b.innerHTML;setTimeout(function(){b.remove()},6E3)}return this.templates[a]}},setToolbar(){const a=y.getElementById("tb_toolbar_template"),b=a.content;"visual"===tb_app.mode?y.body.appendChild(b):a.parentNode.insertBefore(b,a);a.remove()},isImageUrl(a){if(!a)return!1;
a=a.split("?")[0].split(".");return-1!=="jpg jpeg tiff png gif bmp svg".split(" ").indexOf(a[a.length-1])}}})(jQuery,Themify,window.top,document);
