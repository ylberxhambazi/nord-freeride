'use strict';(function(u,X,q,h,k,da){let e,ea,G,fa,Ba,pa,Ca,C,n=null,ha=null,Y=null,J=null,w=null,v=null,E=!1,ia=!1,R=!1,Z,r,ja,qa=!1,aa,S=!1,T=!1;const y=k.Utils.getMouseEvents(),ra=u.isTouch?y:{mousedown:"click"},L=function(a,b){k.hasChanged=!0;h.execCommand(a,!1,void 0!==b?b:null);V()},Fa=function(a){a=h.queryCommandState(a);return-1===a?!1:a},O={formatBlock:{result(a){a=a.parentNode.classList.contains("tb_editor_selected")?"p":a.getAttribute("data-action");L("formatBlock","<"+a+">")},state(a){a=
a.getElementsByClassName("tb_editor_options")[0].getElementsByClassName("tb_editor_action");const b=h.queryCommandValue("formatBlock");for(let c=a.length-1;-1<c;--c){let d=a[c].parentNode.classList;b===a[c].getAttribute("data-action")?d.contains("tb_editor_selected")||(d.add("tb_editor_selected"),Ga(a[c])):d.remove("tb_editor_selected")}}},text_align:{result(a){a.parentNode.classList.contains("tb_editor_selected")?v&&(v.startContainer&&(v.startContainer.parentNode.style.textAlign="",(a=v.startContainer.parentNode.closest("[style*=text-align]"))&&
(a.style.textAlign="")),v.commonAncestorContainer&&(v.commonAncestorContainer.nodeType!==Node.TEXT_NODE&&(v.commonAncestorContainer.style.textAlign=""),(a=v.startContainer.parentNode.closest("[style*=text-align]"))&&(a.style.textAlign="")),V()):L(a.getAttribute("data-action"))},state(a){const b=a.getElementsByClassName("tb_editor_options")[0].getElementsByClassName("tb_editor_action");let c=!1;for(let d=b.length-1;-1<d;--d){let g=b[d].parentNode.classList;b[d].hasAttribute("data-action")&&Fa(b[d].getAttribute("data-action"))?
(g.contains("tb_editor_selected")||Ga(b[d]),c=!0):g.remove("tb_editor_selected")}!1===c&&a.classList.remove("tb_editor_selected")}},list:{result(a){L(a.getAttribute("data-action"))},state(a){O.text_align.state(a)}},image:{state(a){},result(a){const b=h.createElement("div"),c=h.createElement("hidden");qa=!0;let d;c.addEventListener("change",function(f){f.stopImmediatePropagation();f=d.state().get("selection").first().toJSON();var l=f.id;const t=null!==e.closest("[data-hasEditor]");var m=e.classList;
let z=f.title||"",p=f.alt||z;for(var A=m.length-1;-1<A;--A)if(0===m[A].indexOf("wp-image-")){m.remove(m[A]);break}m.add("wp-image-"+l);if(E){Z=e.closest(".active_module").outerHTML;const H=h.createElement("div");l=e.hasAttribute("data-w")||e.hasAttribute("data-h");m=e.hasAttribute("data-w")?e.getAttribute("width"):!1;A=e.hasAttribute("data-h")?e.getAttribute("height"):!1;const W=function(){S=!0;sa(!t);const B=e.closest(".active_module");B&&(e.hasAttribute("data-update")&&(B.innerHTML=B.innerHTML,
e=B.getElementsByClassName("tb_selected_img")[0]),k.Utils.runJs(X(B),"module"));u.trigger("tb_image_resize",e);ta();U();u.requestIdleCallback(function(){setTimeout(function(){requestAnimationFrame(U)},25)},500);H.remove()};H.className="tf_loader";w.appendChild(H);w.classList.add("tb_image_editor_loading");e.removeAttribute("srcset");!t&&l?(e.setAttribute("data-orig",f.url),e.setAttribute("data-ext",f.mime)):(e.removeAttribute("data-ext"),e.removeAttribute("data-orig"),t&&(e.alt=p,e.title=z));if(!l||
t&&!m&&!A)e.width=f.width,e.height=f.height;!m&&!A||t?(e.addEventListener("load",W,{passive:!0,once:!0}),e.setAttribute("src",f.url)):k.Utils.resizeImage(e,m,A).finally(W)}else M(),L("insertImage",f.url);c.remove();b.remove();qa=!1},{passive:!0,once:!0});ThemifyConstructor.file.browse(b,c,ThemifyConstructor,"image");b.click();d=ThemifyConstructor.file._frames.image;const g=function(){d.off("close",g);qa=!1;setTimeout(function(){d=null},50)};d.on("close",g)}},link:{state(a){if(v){a=v.startContainer.parentNode.closest("a");
const b=n.classList;a&&a===v.endContainer.parentNode.closest("a")?(Y.firstChild.textContent=Y.nextElementSibling.href=a.getAttribute("href"),b.add("tb_editor_show_link"),N(),P(!0)):n.classList.contains("tb_editor_show_link")&&(Y.firstChild.textContent=Y.nextElementSibling.href="",b.remove("tb_editor_show_link"),N(),P(!0))}},result(a){a=n.getElementsByClassName("tb_editor_link_options")[0].cloneNode(!0);const b=a.getElementsByClassName("tb_editor_link_input")[0];var c=a.querySelector("#tb_editor_link_type"),
d=v.startContainer.parentNode.closest("a"),g=ThemifyConstructor,f={px:{min:1,max:5E4},"%":{min:1,max:500}};a.querySelector("#tb_editor_lb_w_holder").replaceWith(g.range.render({id:"tb_editor_lb_w",control:!1,units:f},g));a.querySelector("#tb_editor_lb_h_holder").replaceWith(g.range.render({id:"tb_editor_lb_h",control:!1,units:f},g));g=a.querySelector("#tb_editor_lb_w");f=a.querySelector("#tb_editor_lb_h");const l=a.querySelector("#tb_editor_lb_w_unit"),t=a.querySelector("#tb_editor_lb_h_unit");b.value=
g.value=f.value="";c.selectedIndex=l.selectedIndex=t.selectedIndex=0;if(d&&d===v.endContainer.parentNode.closest("a")){var m=d.getAttribute("target");b.value=d.getAttribute("href");"_blank"!==m&&d.hasAttribute("data-zoom-config")&&(m="lightbox");m&&(c.value!==m&&(c.value=m),"lightbox"===m&&(c=d.getAttribute("data-zoom-config").split("|"),d=-1!==c[0].indexOf("%")?"%":"px",m=c[1]&&-1!==c[1].indexOf("%")?"%":"px",parseInt(c[0])!==parseInt(g.value)&&(g.value=parseInt(c[0])),parseInt(c[1])!==parseInt(f.value)&&
(f.value=parseInt(c[1])),l.value!==d&&(l.value=d),t.value!==m&&(t.value=m),a.querySelector(".tb_editor_lightbox_actions").classList.remove("tf_hide")))}a.addEventListener("focusout",Ha,{passive:!0});a.addEventListener("change",Ha,{passive:!0});a.querySelector("#tb_editor_link_type").addEventListener("change",function(z){this.closest("form").querySelector(".tb_editor_lightbox_actions").classList.toggle("tf_hide","lightbox"!==this.value);M();N();P(!0)},{passive:!0});J.appendChild(Ia());J.appendChild(a);
n.classList.add("tf_hide","tb_editor_dialog_open","tb_editor_dialog_link","tf_opacity");a.classList.remove("tf_hide");M();N();P(!0);setTimeout(function(){b.focus()},100)}},font:{state(a){h.queryCommandValue("fontName")},result(a){var b=h.createElement("span"),c=h.createDocumentFragment();a=h.queryCommandValue("fontName");b.className="themify_tooltip";b.textContent="themify_tooltip";c.appendChild(ThemifyConstructor.font_select.render({id:"",control:!1},ThemifyConstructor));c=c.firstChild;n.classList.add("tf_hide",
"tb_editor_dialog_open","tb_editor_dialog_font","tf_opacity");Ja(c);b=c.getElementsByClassName("font-family-select")[0];u.triggerEvent(b.closest(".tb_font_preview_wrapper"),"tf_init");b.addEventListener("change",function(d){d.stopPropagation();R=!0;M();L("styleWithCSS",!0);L("fontName",this.value||"inherit");setTimeout(function(){ka();R=!1},10)},{passive:!0});M();N();P(!0);a&&(a=a.replace(/["']/g,""),b.querySelector('[value="'+CSS.escape(a)+'"]')&&(b.value=a,c.getElementsByClassName("themify-combo-input")[0].value=
a,c=c.getElementsByClassName("themify-combo-dropdown")[0],a=c.querySelector('[data-value="'+CSS.escape(a)+'"]')))&&(a.classList.add("themify-combo-selected"),c.style.scrollBehavior="auto",c.scrollTop=a.offsetTop-a.offsetHeight,c.style.scrollBehavior="")}},unlink:{result(a){M();if((a=v?v.startContainer.parentNode.closest("a"):null)&&a===v.endContainer.parentNode.closest("a")){const b=h.createRange(),c=q.getSelection();b.selectNodeContents(a);c.removeAllRanges();c.addRange(b)}L("unlink");ka()}},unlinkBack:{result(a){O.unlink.result(a);
la()}},color:{result(a){var b=h.createElement("span");const c=function(f){R=!0;M();L("styleWithCSS",!0);L("foreColor",f);setTimeout(function(){ka();R=!1},10)};var d=h.createDocumentFragment();a=h.queryCommandValue("foreColor");b.className="themify_tooltip";b.textContent="themify_tooltip";d.appendChild(ThemifyConstructor.color.render({id:"",control:!1},ThemifyConstructor));d=d.firstChild;n.classList.add("tf_hide","tb_editor_dialog_open","tb_editor_dialog_color","tf_opacity");Ja(d);const g=d.getElementsByClassName("tfminicolors-input")[0];
b=d.getElementsByClassName("tfminicolors-swatch")[0];d=d.getElementsByClassName("color_opacity")[0];if(a){let f=1;-1<a.indexOf("rgb")&&(f=-1<a.indexOf("rgba")?parseFloat(a.split(",").slice(-1).pop()):1,a=(a=a.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i))&&4===a.length?"#"+("0"+parseInt(a[1],10).toString(16)).slice(-2)+("0"+parseInt(a[2],10).toString(16)).slice(-2)+("0"+parseInt(a[3],10).toString(16)).slice(-2):"");g.value=a;d.value=f}b.click();g.addEventListener("themify_builder_color_picker_change",
function(f){f.stopPropagation();"tb_editor_dialog_content"!==h.activeElement.id&&J.contains(h.activeElement)||c(f.detail.val)},{passive:!0});g.addEventListener("change",function(f){f.stopPropagation();c(X(this).tfminicolors("rgbaString"))},{passive:!0});d.addEventListener("change",function(f){S=!0;f.stopPropagation();u.triggerEvent(g,"change")},{passive:!0});N();P(!0)}}},sa=function(a){if(e&&S){const A=k.Models.Registry.lookup(G),H=!(!k.activeModel||G!==k.activeModel.cid);if(A){var b=H?{}:A.get("mod_settings"),
c=X.extend(!0,{},b),d=!1,g=!a&&E,f=e;b||(b={});if(g){var l=f.getAttribute("data-w");var t=f.getAttribute("data-h");if(!l&&!t){f=f.closest("[data-hasEditor]");if(!f)return;g=!1;T=!0}if(g&&(a=!1,l&&(b[l]=f.getAttribute("width"),a=parseInt(c[l])!==parseInt(b[l])),t&&(b[t]=f.getAttribute("height"),!0!==a&&(a=parseInt(c[t])!==parseInt(b[t]))),!a))return}(a=f.getAttribute("data-repeat"))&&!isNaN(a)&&(a=!1);var m=f.getAttribute("data-name");if(a){void 0===b[a]&&(b[a]={});d=f.hasAttribute("data-index")?parseInt(f.getAttribute("data-index")):
!1;if(!1===d){var z=f.closest(".tf_swiper-slide");z||(z=f.closest("li"))||(z=f.closest(".module-"+A.get("mod_name")+"-item"));if(z){const W=z.parentNode.children;for(let B=W.length-1;-1<B;--B)if(W[B]===z){d=B;break}}}if(!1!==d)void 0===b[a][d]&&(b[a][d]={});else return}if(!g){if(!m)return;var p="IMG"===f.tagName?f.hasAttribute("data-orig")?f.getAttribute("data-orig"):f.getAttribute("src"):T?f.innerHTML:f.innerText;!1!==d?(z=void 0!==c[a]&&void 0!==c[a][d]&&void 0!==c[a][d][m]?c[a][d][m]:null,b[a][d][m]=
p):(z=c[m],b[m]=p);if(z===p)return}if(c!==b){if(H){c=da.Lightbox.$lightbox[0];if(g){if(p=!1,d=l?c.querySelector(".tb_lb_option#"+l):null,a=t?c.querySelector(".tb_lb_option#"+t):null,d&&d.value!=b[l]&&(p=!0,d.value=ThemifyConstructor.settings[l]=b[l]),a&&a.value!=b[t]&&(p=!0,a.value=ThemifyConstructor.settings[t]=b[t]),!1===p)return}else if(a?(void 0===ThemifyConstructor.settings[a]&&(ThemifyConstructor.settings[a]={}),void 0===ThemifyConstructor.settings[a][d]&&(ThemifyConstructor.settings[a][d]=
{}),ThemifyConstructor.settings[a][d][m]=p):ThemifyConstructor.settings[m]=p,b={el:"",val:p,data:b,cid:G,activeEl:e},u.triggerEvent(h,"tb_inline_item",b),p=b.val,(b=b.el)||(b=a?c.querySelector("#"+a).querySelectorAll('[data-input-id="'+m+'"]'):c.querySelector(".tb_lb_option#"+m)),b){if(a&&(b=b[d],!b)||b.value===p)return;b.value=p;E&&(l=b.closest(".tb_uploader_wrapper"))&&(l=l.querySelector(".tb_media_uploader img"))&&(l.src=p);T&&"undefined"!==typeof tinyMCE&&tinyMCE&&(b=tinyMCE.get(b.id))&&b.setContent(p)}k.hasChanged=
!0}else b={val:g?b[m]:p,data:b,cid:G,activeEl:e},u.triggerEvent(h,"tb_inline_save",b),p=b.val,b=b.data,!1!==d?b[a][d][m]=p:b[m]=p,k.hasChanged=!0,Z&&(k.undoManager.push(G,Z,da.clone(f.closest(".active_module")),"save",{bsettings:c,asettings:X.extend(!0,{},b)}),Z=null),A.set(b,{silent:!0});ta()}}}},Ka=function(a){a.preventDefault()},ua=function(a){a.stopImmediatePropagation();E&&(e.hasAttribute("data-name")||e.closest("[data-hasEditor]"))&&(a.target===w||w.contains(a.target))&&O.image.result()},Oa=
function(){k.Instances.Builder[k.builderIndex].el.addEventListener(y.mousedown,function(a){if(!0===k.ActionBar.inlineEditor&&(1===a.which||a.touches)){const b=(E="IMG"===a.target.tagName)?a.target:a.target.closest("[contenteditable]");if(b&&!b.closest(".tb_disable_sorting")&&(E||!1===b.contentEditable||"false"===b.contentEditable)){ba();q.getSelection().removeAllRanges();const c=b.closest(".active_module");if(c){if((a=k.Models.Registry.lookup(c.dataset.cid))&&void 0!==a.attributes.mod_settings.__dc__&&
void 0!==a.attributes.mod_settings.__dc__[b.dataset.name])return!1;c.classList.add("tb_editor_clicked")}E||(b.contentEditable=!0);let d=[];for(a=b.closest("[draggable]");null!==a;)d.push(a),a=a.parentNode.closest("[draggable]");if(0<d.length){const g=function(l){h.removeEventListener(y.mousemove,f,{passive:!0,once:!0});for(l=d.length-1;-1<l;--l)d[l].setAttribute("draggable",!1),d[l].removeEventListener("drag",f,{passive:!0,once:!0})},f=function(l){b.setAttribute("contenteditable",!1);h.removeEventListener(y.mousemove,
f,{passive:!0,once:!0});b.removeEventListener(y.mouseup,g,{passive:!0,once:!0});c&&c.classList.remove("tb_editor_clicked");for(let t=d.length-1;-1<t;--t)d[t].removeEventListener("drag",f,{passive:!0,once:!0});Da();"drag"===l.type&&D()};b.addEventListener(y.mouseup,g,{passive:!0,once:!0});h.addEventListener(y.mousemove,f,{passive:!0,once:!0});for(a=d.length-1;-1<a;--a)d[a].addEventListener("drag",f,{passive:!0,once:!0})}}}},{passive:!0});k.Instances.Builder[k.builderIndex].el.addEventListener(ra.mousedown,
function(a){if(!0===k.ActionBar.inlineEditor){var b=a.target;if(b.hasAttribute("data-target")){var c=b.closest(".active_module");c&&(c=c.querySelector(b.getAttribute("data-target")))&&(b=c)}var d=(E="IMG"===b.tagName)?b:b.closest("[contentEditable]");if(d&&((d.closest("label")||d.closest("a")||d.closest("button"))&&a.preventDefault(),e!==d&&(e&&D(),(1===a.which||a.touches)&&(!E||d.getAttribute("data-w")||d.getAttribute("data-h")||d.getAttribute("data-name")||d.closest("[data-hasEditor]"))))){var g=
d.closest(".active_module");if(g&&(G=g.getAttribute("data-cid"),(a=k.Models.Registry.lookup(G))&&void 0!==a.attributes.mod_settings.__dc__&&void 0!==a.attributes.mod_settings.__dc__[d.dataset.name]))return;S=!1;C=u.body[0].classList;ba();C.add("tb_editor_active");q.top.document.body.classList.add("tb_editor_active");T=!E&&d.hasAttribute("data-hasEditor");e=d;g&&(Z=g.outerHTML,g.classList.add("tb_editor_on"),g.classList.remove("tb_editor_clicked"));a=e;c=d.closest("form");b=d.closest("[draggable]");
if(c){c.addEventListener("submit",Ka);c=c.querySelectorAll("[required]");for(let f=c.length-1;-1<f;--f)c[f].removeAttribute("required"),c[f].setAttribute("data-required",1)}for(;a&&a!==g;)a.style["animation-name"]&&(a.setAttribute("data-tmp-animation",a.style["animation-name"]),a.style["animation-name"]="none"),a=a.parentNode;for(;null!==b;)b.setAttribute("draggable",!1),b=b.parentNode.closest("[draggable]");a=b=c=null;(r=(r=e.closest(".tf_swiper-container"))&&r.swiper?r.swiper:null)&&r.params&&r.params.autoplay&&
r.params.autoplay.enabled&&(r.el.dataset.stopped=!0,r.autoplay.stop(),r.params.thumbs&&r.params.thumbs.swiper&&r.params.thumbs.swiper.autoplay&&r.params.thumbs.swiper.autoplay.enabled&&(r.params.thumbs.swiper.el.dataset.stopped=!0,r.params.thumbs.swiper.autoplay.stop()));E?(C.add("tb_editor_image_active"),q.top.document.body.classList.add("tb_editor_image_active"),u.on("tfsmartresize",U).on("tbresizeImageEditor",U)):(ja=T?e.innerHTML:e.textContent,e.contentEditable=!0,e.focus(),e.addEventListener("blur",
D,{passive:!0}),e.addEventListener("input",V,{passive:!0}),e.addEventListener("change",V,{passive:!0}),u.isTouch||setTimeout(function(){g&&g.addEventListener("dblclick",ua,{passive:!0})},800),ea=k.undoManager.stack,k.undoManager.reset());u.on("tbDisableInline",D);h.addEventListener(y.mousedown,D,{passive:!0});q.top.document.addEventListener(y.mousedown,D,{passive:!0});setTimeout(function(){da.Lightbox.$lightbox.one("themify_opened_lightbox",La)},600);T?(h.addEventListener("selectionchange",Ma,{passive:!0}),
Va(),N(),n.addEventListener(ra.mousedown,Na),Y=n.querySelector("#tb_editor_link_value"),J=n.querySelector("#tb_editor_dialog")):E&&(d.closest(".masonry")?u.requestIdleCallback(function(){setTimeout(function(){requestAnimationFrame(function(){Ea(d)})},25)},500):Ea(d))}}})},N=function(){const a=n.className;var b=n.classList;b.add("tf_hidden");b.remove("tf_hide");b=n.getBoundingClientRect();fa=b.width+40;Ba=b.height+30;n.className=a},ka=function(){const a=q.getSelection();v=!1===a.isCollapsed?a.getRangeAt(0).cloneRange():
null},M=function(){if(!1===ia&&v){ia=!0;e.focus();const a=q.getSelection();a.removeAllRanges();a.addRange(v);ia=!1}},Va=function(){if(null===n){const a=h.getElementById("tmpl-builder_inline_editor");a&&(h.body.appendChild(a.content),a.remove());n=h.getElementById("tb_editor")}return n},Na=function(a){var b=a.target.closest(".tb_editor_action");a.stopPropagation();b&&"submit"!==b.type&&(a.preventDefault(),R=!0,(a=b.getAttribute("data-type"))||(a=b.closest("[data-type]").getAttribute("data-type")),
"expand"!==a?(void 0!==O[a]&&void 0!==O[a].result?O[a].result(b):(M(),L(a)),Pa()):!b.classList.contains("tb_editor_disable")&&(b=k.Models.Registry.lookup(G))&&(D(),q.getSelection().removeAllRanges(),b.trigger("edit",null)),R=!1)},V=function(a){a&&a.stopPropagation();if(e){S=!0;const b=T?e.innerHTML:e.textContent;if(ja!==b||E)k.hasChanged=!0,k.activeModel&&k.activeModel.cid===G&&sa(),a&&"input"!==a.type||k.undoManager.push(G,ja,b,"inline",e),ja=b}},Ha=function(a){a.stopPropagation();if(!("focusout"===
a.type&&!a.target.classList.contains("tb_range")||"change"===a.type&&a.target.classList.contains("tb_range"))&&(a=this.getElementsByClassName("tb_editor_link_input")[0].value.trim())){S=!0;M();var b=q.getSelection(),c=v?v.startContainer.parentNode.closest("a"):null,d=this.querySelector("#tb_editor_link_type").value;if(c&&c===v.endContainer.parentNode.closest("a")){var g=h.createRange();g.selectNodeContents(c);b.removeAllRanges();b.addRange(g)}L("createLink",a);ka();if(b.anchorNode&&b.anchorNode.parentNode&&
(a=b.anchorNode.parentNode.closest("a")))if(a.removeAttribute("target"),a.removeAttribute("data-zoom-config"),a.classList.remove("themify_lightbox"),"_blank"===d)a.setAttribute("target",d);else if("lightbox"===d&&(a.classList.add("themify_lightbox"),d=this.querySelector("#tb_editor_lb_w").value,b=this.querySelector("#tb_editor_lb_h").value,c=this.querySelector("#tb_editor_lb_w_unit").value||"px",g=this.querySelector("#tb_editor_lb_h_unit").value||"px",0<d||0<b)){let f="|";d&&(f=d+c+f);b&&(f+=b+g);
a.setAttribute("data-zoom-config",f)}V()}},Ga=function(a){var b=a.parentNode;const c=b.parentNode.closest("li");b.classList.add("tb_editor_selected");c&&(c.classList.add("tb_editor_selected"),b=c.getElementsByClassName("tb_editor_action")[0],void 0!==b&&b.parentNode.replaceChild(a.cloneNode(!0),b))},Pa=function(){null===ha&&(ha=n.querySelectorAll("[data-type]"));for(let b=ha.length-1;-1<b;--b){var a=ha[b];let c=a.getAttribute("data-type");a="LI"===a.tagName?a:a.parentNode;"expand"===c?a.classList.toggle("tb_editor_disable",
k.activeModel&&G===k.activeModel.cid):c&&(void 0!==O[c]&&void 0!==O[c].state?O[c].state(a):a.classList.toggle("tb_editor_selected",Fa(c)))}},P=function(a){if(null!==n){var b=q.getSelection(),c=n.classList;if(!1===b.isCollapsed){ka();c.contains("tf_hide")&&(N(),c.remove("tf_hide"),setTimeout(function(){c.remove("tf_opacity")},20));b=v.getBoundingClientRect();let d=b.left+(b.width-fa)/2,g=b.top-Ba-10;d+fa>=u.w&&(d-=fa+Math.ceil(d)+q.pageXOffset-u.w-1);c.toggle("tb_editor_top_viewport",0>=g);0>=g&&(g=
b.bottom+10);0>=d&&(d=15);g+=q.pageYOffset;n.style.transform="translate("+d+"px,"+g+"px)";void 0===a&&Pa();C&&(C.contains("tb_editor_start_select")||(q.top.document.body.classList.add("tb_editor_start_select"),C.add("tb_editor_start_select")),aa&&clearTimeout(aa),aa=setTimeout(ba,500))}else v=null,c.add("tf_hide","tf_opacity"),c.remove("tb_editor_top_viewport"),la()}},Ma=function(){null!==e&&!1===ia&&!1===R&&h.activeElement===e&&(pa&&cancelAnimationFrame(pa),Ca&&clearTimeout(Ca),pa=requestAnimationFrame(function(){Ca=
setTimeout(function(){null!==e&&!1===ia&&!1===R&&h.activeElement===e&&P()},20)}))},ba=function(a){C&&C.contains("tb_editor_start_select")&&(q.top.document.body.classList.remove("tb_editor_start_select"),C.remove("tb_editor_start_select"));aa&&clearTimeout(aa);aa=null},Ia=function(){const a=h.createElement("button");a.type="button";a.className="tf_close";a.title="Back";a.addEventListener(ra.mousedown,function(b){b.stopImmediatePropagation();b.preventDefault();la();n.classList.add("tf_hide","tf_opacity");
M();N();P()},{once:!0});return a},Ja=function(a){const b=h.createElement("div"),c=h.createElement("div");b.id="tb_editor_dialog_header";c.id="tb_editor_dialog_content";c.tabIndex="-1";b.appendChild(Ia());c.appendChild(a);J.appendChild(b);J.appendChild(c)},la=function(){if(n){n.style.display="none";if(J&&J.firstChild)for(;J.firstChild;)J.removeChild(J.lastChild);n.classList.remove("tb_editor_dialog_open","tb_editor_dialog_color","tb_editor_dialog_font","tb_editor_dialog_link","tb_editor_show_link");
n.style.display="";N()}},La=function(a){e&&D()},Ea=function(a){Da();w=h.createElement("div");var b=a.getBoundingClientRect();const c=0!==(e.dataset.orig?e.dataset.orig.trim():e.src.trim()).indexOf(themifyBuilder.upload_url)?themifyBuilder.i18n.image_help:null!==e.closest("[data-hasEditor]")?themifyBuilder.i18n.image_help2:!1,d=["w","s","e","n"];w.id="tb_editor_image";w.style.top=b.top+q.scrollY+"px";w.style.left=b.left+q.scrollX+"px";w.style.width=b.width+"px";w.style.height=b.height+"px";for(b=d.length-
1;-1<b;--b){let g=h.createElement("div"),f=h.createElement("div"),l=h.createElement("div");g.className="tb_editor_image_handler tb_editor_"+d[b];f.className="tb_editor_image_border tb_editor_border_"+d[b];l.className="tb_image_editor_tooltip tb_image_editor_tooltip_"+d[b];w.appendChild(f);w.appendChild(l);w.appendChild(g)}a.hasAttribute("data-w")||a.hasAttribute("data-h")?!1!==c&&w.appendChild(ThemifyConstructor.help(c)):w.className="tb_image_editor_disable";w.addEventListener(y.mousedown,Qa,{passive:!0});
u.isTouch||w.addEventListener("dblclick",ua,{passive:!0});e.classList.add("tb_selected_img");u.body[0].appendChild(w)},Qa=function(a){if(1===a.which||a.touches){var b=a.target;a.stopPropagation();if((e.hasAttribute("data-w")||e.hasAttribute("data-h"))&&(b.classList.contains("tb_editor_image_handler")||b.classList.contains("tb_editor_image_border"))){this.style.willChange="width,height,left,top";e.parentNode.style.willChange="contents";e.style.willChange="width,height";let d,g,f,l,t,m,z,p=new Image;
var c=e.getAttribute("data-maxw");let A=!1;c&&(c=e.closest(c));c||(c=e.closest("[data-hasEditor]"),c||(c=e.parentNode));const H=b.classList[1].replace("tb_editor_border_","").replace("tb_editor_",""),W=b.classList.contains("tb_editor_image_handler"),B=this,Ra=Number.MAX_VALUE;c=e.getBoundingClientRect();const ca=parseInt(c.width),va=parseInt(c.height),Wa=parseFloat(ca/va),wa=a.touches?a.touches[0].clientX:a.clientX,Sa=a.touches?a.touches[0].clientY:a.clientY,xa=B.getElementsByClassName("tb_image_editor_tooltip"),
ya=e.dataset.orig?e.dataset.orig.trim():e.src.trim(),za=0===ya.indexOf(themifyBuilder.upload_url)&&!e.closest("[data-hasEditor]"),ma=!0===za?h.createElement("div"):null,Ta=function(F){F.stopPropagation();f=F.touches?F.touches[0].clientX:F.clientX;l=F.touches?F.touches[0].clientY:F.clientY;!1===A?(A=!0,e.classList.add("tb_resized_img")):d&&cancelAnimationFrame(d);d=requestAnimationFrame(function(){if(null===e)Aa();else{if(!0===W){var x="n"===H||"s"===H?wa+ca-f:ca+f-wa;var K=parseInt(x/Wa)}else"s"===
H||"n"===H?(K="s"===H?va+l-Sa:Sa+va-l,x=ca):(x="w"===H?ca+f-wa:wa+ca-f,K=va);40>x?x=40:x>Ra&&(x=Ra);void 0!==K&&40>K&&(K=40);if(t!==x||m!==K)t=x,m=K,k.Utils.resizeImage(e,x,K,p).then(function(Q){if(null===Q[0]||null===e)Aa();else{var I=!1===za?Q[0].parentNode:null;null!==I&&"FIGURE"===I.tagName&&(I.style.width&&(I.style.width=Q[1]+"px"),I.style.height&&(I.style.height=Q[2]+"px"));I=Q[0].getBoundingClientRect();B.style.left=I.left+q.scrollX+"px";B.style.top=I.top+q.scrollY+"px";B.style.width=I.width+
"px";B.style.height=I.height+"px";xa[0].textContent=xa[3].textContent=parseInt(Q[1])+"px";xa[1].textContent=xa[2].textContent=parseInt(Q[2])+"px";ta()}})}})};a=function(){h.addEventListener(y.mousemove,Ta,{passive:!0});B.classList.remove("tb_image_editor_loading");ma&&ma.remove()};const Aa=function(F){F&&F.stopPropagation();d&&cancelAnimationFrame(d);g&&clearTimeout(g);h.removeEventListener(y.mousemove,Ta,{passive:!0});h.removeEventListener(y.mouseup,Aa,{passive:!0,once:!0});q.top.document.body.classList.remove("tb_start_animate",
"tb_image_editor_resing");(C?C:u.body[0].classList).remove("tb_start_animate","tb_image_editor_resing");u.body[0].style.cursor=q.top.document.body.style.cursor=B.style.willChange=e.style.willChange=e.parentNode.style.willChange="";e.classList.remove("tb_resized_img");if(!0===A){S=!0;let x=e.closest(".active_module");x||(x=e.closest(".module_column"));sa();const K=function(){requestAnimationFrame(function(){p&&(z=u.hash(ya+e.getAttribute("width")+e.getAttribute("height")),k.Utils.cache_images[z]=p,
p=null);ta();x&&(e.hasAttribute("data-update")&&(x.innerHTML=x.innerHTML,e=E?x.getElementsByClassName("tb_selected_img")[0]:x.querySelector('[contenteditable="true"]')),k.Utils.runJs(X(x),"module"));u.trigger("tb_image_resize",e);U();u.requestIdleCallback(function(){setTimeout(function(){requestAnimationFrame(U)},25)},500);k.Utils.canvas=k.Utils.ctx=null})};if(x)if(F=x.querySelectorAll('img[data-w="'+e.getAttribute("data-w")+'"]'),1<F.length){const Q=e.getAttribute("width"),I=e.getAttribute("height"),
na=za?h.createElement("div"):null,Ua=[];na&&(na.className="tf_loader tf_loader_center",x.appendChild(na),x.classList.add("tf_image_editor_working"));for(let oa=F.length-1;-1<oa;--oa)F[oa]!==e&&Ua.push(k.Utils.resizeImage(F[oa],Q,I));Promise.all(Ua).then(oa=>{na&&na.remove();x.classList.remove("tf_image_editor_working");K()})}else K();else K()}A=!1;d=g=t=m=null};C.add("tb_start_animate","tb_image_editor_resing");q.top.document.body.classList.add("tb_start_animate","tb_image_editor_resing");u.body[0].style.cursor=
q.top.document.body.style.cursor=getComputedStyle(b).getPropertyValue("cursor");!0===za?(z=u.hash(ya+e.getAttribute("width")+e.getAttribute("height")),void 0!==k.Utils.cache_images[z]?(p=k.Utils.cache_images[z],a()):(ma&&(ma.className="tf_loader",this.appendChild(ma),this.classList.add("tb_image_editor_loading")),p.src=ya,p.crossOrigin="anonymous",p.decode().then(a))):a();h.addEventListener(y.mouseup,Aa,{passive:!0,once:!0})}}},U=function(){w&&requestAnimationFrame(function(){w&&e&&Ea(e)})},ta=function(){null!==
r&&r.update()},Da=function(){w&&(w.removeEventListener(y.mousedown,Qa,{passive:!0}),w.removeEventListener("dblclick",ua,{passive:!0}),w.remove(),w=null)},D=function(a){if(!qa){var b=null;if(a&&(b="blur"===a.type?a.relatedTarget?a.relatedTarget:da.Lightbox.$lightbox[0].contains(q.top.document.activeElement)?q.top.document.activeElement:h.activeElement:a.target,!E&&b.closest(".tb_toolbar_undo"))){e&&e.removeEventListener("blur",D,{passive:!0});setTimeout(function(){e&&e.addEventListener("blur",D,{passive:!0});
v=null;la();e&&e.focus();P()},120);return}if(!a||"blur"===a.type||1===a.which)if(!a||!n||(a.touches||"blur"===a.type||1===a.which)&&n!==b&&!n.contains(b)){let g=e&&k.Instances.Builder[k.builderIndex].el.contains(e)?e.closest(".module"):k.Instances.Builder[k.builderIndex].el.querySelector(".tb_element_cid_"+G+" .module");la();if(a&&g&&(g===b||g.contains(b)))a&&"blur"!==a.type&&e&&!1===q.getSelection().isCollapsed&&(C.contains("tb_editor_start_select")||(q.top.document.body.classList.add("tb_editor_start_select"),
C.add("tb_editor_start_select")),this.addEventListener(y.mouseup,ba,{passive:!0,once:!0}));else{h.removeEventListener(y.mousedown,D,{passive:!0});h.removeEventListener("selectionchange",Ma,{passive:!0});h.removeEventListener(y.mouseup,ba,{passive:!0,once:!0});q.top.document.removeEventListener(y.mousedown,D,{passive:!0});da.Lightbox.$lightbox.off("themify_opened_lightbox",La);ba();ea&&(k.undoManager.stack=ea,k.undoManager.index=ea.length-1,k.undoManager.updateUndoBtns());if(e){e.removeEventListener("input",
V,{passive:!0});e.removeEventListener("change",V,{passive:!0});e.removeEventListener("blur",D,{passive:!0});"IMG"!==e.tagName&&e.setAttribute("contenteditable","false");e.classList.remove("tb_selected_img");b=e.closest("form");for(var c=[],d=e.closest("[draggable]");null!==d;)c.push(d),d=d.parentNode.closest("[draggable]");for(d=c.length-1;-1<d;--d)c[d].setAttribute("draggable",!0);if(b)for(b.removeEventListener("submit",Ka),b=b.querySelectorAll("[data-required]"),c=b.length-1;-1<c;--c)b[c].removeAttribute("data-required"),
b[c].setAttribute("required","required");for(b=e;b&&b.classList&&!b.classList.contains("active_module");)b.getAttribute("data-tmp-animation")&&(b.style["animation-name"]=b.getAttribute("data-tmp-animation"),b.removeAttribute("data-tmp-animation")),b=b.parentNode;b=null}r&&r.params&&r.params.autoplay&&r.params.autoplay.enabled&&(r.el.dataset.stopped=!1,r.autoplay.start(),r.params.thumbs&&r.params.thumbs.swiper.autoplay&&r.params.thumbs.swiper.autoplay.enabled&&(r.params.thumbs.swiper.el.dataset.stopped=
!1,r.params.thumbs.swiper.autoplay.start()));n&&(n.classList.add("tf_hide","tf_opacity"),n.classList.remove("tb_editor_top_viewport","tb_editor_show_link"),n.removeEventListener(ra.mousedown,Na));a&&q.getSelection().removeAllRanges();u.off("tfsmartresize",U).off("tbresizeImageEditor",U).off("tbDisableInline",D);Da();C&&C.remove("tb_editor_active","tb_editor_image_active","tb_editor_start_select");q.top.document.body.classList.remove("tb_editor_active","tb_editor_image_active","tb_editor_start_select");
k.ActionBar.clear();g&&(g=g.closest(".active_module"))&&(g.classList.remove("tb_editor_on","tb_editor_clicked"),g.removeEventListener("dblclick",ua,{passive:!0}),S&&(sa(),e.hasAttribute("data-no-update")||k.Utils.runJs(X(g),"module")));k.ActionBar.hoverCid=Z=n=C=T=v=fa=Ba=pa=ha=J=Y=G=ea=ja=r=e=null}}}};if(u.is_builder_loaded)Oa();else u.on("tb_css_visual_modules_load",Oa,!0);u.on("undo",function(a,b,c,d){"inline"!==b&&D()}).on("disableInline",function(){D()})})(Themify,jQuery,window,document,tb_app,
ThemifyBuilderCommon);
