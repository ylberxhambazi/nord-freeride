((S,k,$,u,q,f,I)=>{'use strict';let R,B,O,U,K,c,o,M,P=q.tfId('tb_inline_editor_root'),g=null,m=null,n=null,h=null,b=null,_=null,y=!1,t=!1,d=!1,r,V=!1,p,D=!1,v=!1,W=!1,l,z,F,C=-1,G=null,w,N=[];const J=e=>{let t=e.getBoundingClientRect(),a=0,s=0,i=t.top+u.scrollY,o=t.left+u.scrollX;for(;null!==e;)a+=e.offsetTop,s+=e.offsetLeft,e=e.offsetParent;return i-=a,o-=s,{top:a,left:s+o,width:t.width,height:t.height,diffTop:i,diffLeft:o}},Y=()=>k.importJs('image-resize'),Q=e=>{if(null===G){const t=u.getSelection(),a={el:e};if(N.splice(C+1,N.length-C),0!==t.rangeCount){const s=t.getRangeAt(0).cloneRange();a.r={startOffset:s.startOffset,endOffset:s.endOffset,collapsed:s.collapsed,startContainer:S.Helper.cloneDom(s.startContainer),endContainer:S.Helper.cloneDom(s.endContainer)}}N.push(a),C=N.length-1}},L=(e,...t)=>{const a=t[0]!==I?t[0]:null;q.execCommand('styleWithCSS',!1,!0),q.execCommand(e,!1,a)},i=e=>{const t=q.queryCommandState(e);return-1!==t&&t},T={undo:{result(e,t){G=!0;const a='undo'===(t=t||'undo')?0:1,s=C+a,i=N[s];if('undo'===t?--C:++C,i!==I){if(i.el===R.innerHTML)return void T[t].result(e);let r=i.r;if(R.innerHTML=i.el,r){let e=r.startOffset,t=r.endOffset,a=r.collapsed,s=r.startContainer,i=r.endContainer,o,n,l;const d=u.getSelection(),c=new Range,f=s.nodeType===Node.TEXT_NODE?s.textContent:null,m=i.nodeType===Node.TEXT_NODE?i.textContent:null,p=e=>{if(!o||!n){const t=e.childNodes;for(let e=t.length-1;-1<e&&(!o||!n);--e)l||t[e].nodeType!==Node.TEXT_NODE||(l=t[e]),!o&&(t[e].isEqualNode(s)||null!==f&&t[e].nodeType===Node.TEXT_NODE&&t[e].textContent===f)&&(o=t[e]),!n&&(t[e].isEqualNode(i)||null!==m&&t[e].nodeType===Node.TEXT_NODE&&t[e].textContent===m)&&(n=t[e]),p(t[e])}};p(R),d.removeAllRanges(),R.focus(),(o=o||n?o:n=l)&&n&&(c.collapse(a),c.setStart(o,e),c.setEnd(n,t),d.addRange(c))}E()}G=null},state(e,t){const a='redo'===t?C<N.length-1:-1<C;return e&&e.toggleClass('disabled',!a),a}},redo:{result(e){T.undo.result(e,'redo')},state(e){return T.undo.state(e,'redo')}},formatBlock:{result(e){const t=e.parentNode.classList.contains('selected')?'p':e.dataset.action;L('formatBlock','<'+t+'>')},state(e){const a=e.tfClass('submenu')[0].tfClass('action'),s=q.queryCommandValue('formatBlock');for(let t=a.length-1;-1<t;--t){let e=a[t].parentNode.classList;s===a[t].dataset.action?e.contains('selected')||(e.add('selected'),re(a[t])):e.remove('selected')}}},text_align:{result(e){if(e.parentNode.classList.contains('selected')){if(_){if(_.startContainer){_.startContainer.parentNode.style.textAlign='';const t=_.startContainer.parentNode.closest('[style*=text-align]');t&&(t.style.textAlign='')}if(_.commonAncestorContainer){_.commonAncestorContainer.nodeType!==Node.TEXT_NODE&&(_.commonAncestorContainer.style.textAlign='');const a=_.startContainer.parentNode.closest('[style*=text-align]');a&&(a.style.textAlign='')}ne()}}else L(e.dataset.action)},state(e){const a=e.tfClass('submenu')[0].tfClass('action');let s=!1;for(let t=a.length-1;-1<t;--t){let e=a[t].parentNode.classList;a[t].hasAttribute('data-action')&&i(a[t].dataset.action)?(e.contains('selected')||re(a[t]),s=!0):e.remove('selected')}!1===s&&e.classList.remove('selected')}},list:{result(e){L(e.dataset.action)},state(e){T.text_align.state(e)}},image:{state(e){},result(e){const g=q.createElement('div'),h=q.createElement('hidden');V=!0;let _;h.tfOn('change',async e=>{e.stopImmediatePropagation();const t=_.state().get('selection').first().toJSON(),a=t.id,s=t.title||'',i=t.alt||s;let o=R;if(!y){A();const r='<img src="'+t.url+'" class="tb_inserted_image">';L('insertHTML',r),(o=R.tfClass('tb_inserted_image')[0]).classList.remove('tb_inserted_image'),o.removeAttribute('style')}const n=null!==o.closest('[data-hasEditor]'),l=o.classList;if(y||n){const d=q.createElement('div'),c=o.hasAttribute('data-w')||o.hasAttribute('data-h'),f=!!o.hasAttribute('data-w')&&o.getAttribute('width'),m=!!o.hasAttribute('data-h')&&o.getAttribute('height'),p=async()=>{if(D=!0,Z(!n),y){const e=o.closest('.active_module');await k.trigger('tb_image_resize',[R,B,f,m]),ye(),e&&await S.Utils.runJs(e,'module'),H(),k.requestIdleCallback(()=>{setTimeout(()=>{requestAnimationFrame(H)},25)},500)}else o.click();d.remove()};if(y&&(d.className='tf_loader tf_abs_c',b.appendChild(d),b.classList.add('tb_image_editor_loading')),o.removeAttribute('srcset'),!n&&c?o.dataset.orig=t.url:(o.removeAttribute('data-orig'),n&&(o.alt=i,o.title=s)),c&&(!n||f||m)||(o.width=t.width,o.height=t.height),!f&&!m||n)X(),o.tfOn('load',p,{passive:!0,once:!0}).src=t.url;else{const u=(await Y()).ThemifyImageResize;u.toBlob(o,f,m).finally(p)}}for(let e=l.length-1;-1<e;--e)if(0===l[e].indexOf('wp-image-')){l.remove(l[e]);break}l.add('wp-image-'+a),h.remove(),g.remove(),V=!1},{passive:!0,once:!0}),ThemifyConstructor.mediaFile.browse(g,h,ThemifyConstructor,'image'),g.click(),_=ThemifyConstructor.mediaFile._frames.image;const t=()=>{_.off('close',t),V=!1,setTimeout(()=>{_=null},50)};_.on('close',t)}},link:{state(e){if(_){const t=_.startContainer.parentNode.closest('a'),a=g.classList;t&&t===_.endContainer.parentNode.closest('a')?(n.firstChild.textContent=n.nextElementSibling.href=t.getAttribute('href'),a.add('show_link'),x(),E(!0)):g.classList.contains('show_link')&&(n.firstChild.textContent=n.nextElementSibling.href='',a.remove('show_link'),x(),E(!0))}},result(e){const t=g.tfClass('link_form')[0].cloneNode(!0),a=t.tfClass('link_input')[0],s=t.querySelector('#link_type'),i=_.startContainer.parentNode.closest('a'),o=ThemifyConstructor,n={px:{min:1,max:5e4},'%':{min:1,max:500}},l=(t.querySelector('#lb_w_holder').replaceWith(o.range.render({id:'lb_w',control:!1,units:n},o)),t.querySelector('#lb_h_holder').replaceWith(o.range.render({id:'lb_h',control:!1,units:n},o)),t.querySelector('#lb_w')),r=t.querySelector('#lb_h'),d=t.querySelector('#lb_w_unit'),c=t.querySelector('#lb_h_unit');if(a.value=l.value=r.value='',s.selectedIndex=d.selectedIndex=c.selectedIndex=0,i&&i===_.endContainer.parentNode.closest('a')){let e=i.target;if(a.value=i.getAttribute('href'),(e='_blank'!==e&&i.hasAttribute('data-zoom-config')?'lightbox':e)&&(s.value!==e&&(s.value=e),'lightbox'===e)){const f=i.dataset.zoomConfig.split('|'),m=-1!==f[0].indexOf('%')?'%':'px',p=f[1]&&-1!==f[1].indexOf('%')?'%':'px';parseInt(f[0])!==parseInt(l.value)&&(l.value=parseInt(f[0])),parseInt(f[1])!==parseInt(r.value)&&(r.value=parseInt(f[1])),d.value!==m&&(d.value=m),c.value!==p&&(c.value=p),t.querySelector('.lightbox').classList.remove('tf_hide')}}t.tfOn('focusout change',le,{passive:!0}).tfOn('submit',le).querySelector('#link_type').tfOn('change',e=>{const t=e.currentTarget,a=t.closest('form').querySelector('.lightbox');a.classList.toggle('tf_hide','lightbox'!==t.value),A(),x(),E(!0)},{passive:!0}),h.append(me(),t),g.classList.add('tf_hide','dialog_open','dialog_link','tf_opacity'),t.classList.remove('tf_hide'),A(),x(),E(!0),setTimeout(()=>{a.focus()},100)}},font:{state(e){q.queryCommandValue('fontName')},result(e){const t=q.createElement('span');let a=q.createDocumentFragment(),s=q.queryCommandValue('fontName');t.className='themify_tooltip',t.textContent='themify_tooltip',a.appendChild(ThemifyConstructor.font_select.render({id:'',control:!1},ThemifyConstructor)),a=a.firstChild,g.classList.add('tf_hide','dialog_open','dialog_font','tf_opacity'),pe(a);const i=a.tfClass('font-family-select')[0];if(k.triggerEvent(i.closest('.tb_font_preview_wrapper'),'tf_init'),i.tfOn('change',function(e){e.stopPropagation(),d=!0,A(),L('fontName',this.value||'inherit'),setTimeout(()=>{ae(),d=!1},10)},{passive:!0}),A(),x(),E(!0),s&&(s=s.replace(/["']/g,''),i.querySelector('[value="'+CSS.escape(s)+'"]'))){i.value=s,a.tfClass('themify-combo-input')[0].value=s;const o=a.tfClass('themify-combo-dropdown')[0],n=o.querySelector('[data-value="'+CSS.escape(s)+'"]');n&&(n.classList.add('themify-combo-selected'),o.style.scrollBehavior='auto',o.scrollTop=n.offsetTop-n.offsetHeight,o.style.scrollBehavior='')}}},unlink:{result(e){A();const t=_?_.startContainer.parentNode.closest('a'):null;if(t&&t===_.endContainer.parentNode.closest('a')){const a=q.createRange(),s=u.getSelection();a.selectNodeContents(t),s.removeAllRanges(),s.addRange(a)}L('unlink'),ae()}},unlinkBack:{result(e){T.unlink.result(e),ue()}},color:{result(e){const t=q.createElement('span'),a=e=>{if(d=!0,A(),''===e&&(e='inherit'),L('foreColor',e),'inherit'===e&&_&&_.commonAncestorContainer){const t=_.commonAncestorContainer.querySelectorAll('span[style]');for(let e=t.length-1;-1<e;--e)'inherit'===t[e].style.color&&(t[e].style.color='',t[e].style||(t[e].outerHTML=t[e].innerHTML));ne()}setTimeout(()=>{ae(),d=!1},10)};let s=q.createDocumentFragment(),i=q.queryCommandValue('foreColor');t.className='themify_tooltip',t.textContent='themify_tooltip',s.appendChild(ThemifyConstructor.color.render({id:'',control:!1},ThemifyConstructor)),s=s.firstChild,g.classList.add('tf_hide','dialog_open','dialog_color','tf_opacity'),pe(s);const o=s.tfClass('tfminicolors-input')[0],n=s.tfClass('tfminicolors-swatch')[0],l=s.tfClass('color_opacity')[0];if(i){let e=1;if(-1<i.indexOf('rgb')){e=-1<i.indexOf('rgba')?parseFloat(i.split(',').slice(-1).pop()):1;const r=i.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);i=r&&4===r.length?"#"+("0"+parseInt(r[1],10).toString(16)).slice(-2)+("0"+parseInt(r[2],10).toString(16)).slice(-2)+("0"+parseInt(r[3],10).toString(16)).slice(-2):''}o.value=i,l.value=e}n.click(),o.tfOn('themify_builder_color_picker_change',e=>{e.stopPropagation();const t=e.detail.val;'dialog_content'!==q.activeElement.id&&h.contains(q.activeElement)&&''!==t||a(t)},{passive:!0}).tfOn('change',function(e){e.stopPropagation(),a($(this).tfminicolors('rgbaString'))},{passive:!0}),l.tfOn('change',e=>{D=!0,e.stopPropagation(),k.triggerEvent(o,'change')},{passive:!0}),x(),E(!0)}}},Z=t=>{if(R&&D&&B){const n=S.activeModel===B;let i=!1,e=!t&&y,s=R,o=new Map;if(W=!0,e){const a=s.dataset.w,l=s.dataset.h;if(!a&&!l){if(!(s=s.closest('[data-hasEditor]')))return;e=!1,v=!0}e&&(a&&o.set(a,s.getAttribute('width')),l&&o.set(l,s.getAttribute('height')))}if(!e){const r=s.dataset.name;if(r){let e='IMG'===s.tagName?s.dataset.orig||s.src:v?s.innerHTML:s.innerText;!1!==(e=O?O.save(B,R,r,e,o,!n):e)&&null!==e&&o.set(r,e)}}if(0!==o.size){let a=s.dataset.repeat;if(a=!(a&&!isNaN(a))&&a){if(!1===(i=!!s.hasAttribute('data-index')&&parseInt(s.dataset.index))){let t=s.closest('.tf_swiper-slide');if(t=t||s.closest('li')||s.closest('.module-'+B.get('mod_name')+'-item')){const d=t.parentNode.children;for(let e=d.length-1;-1<e;--e)if(d[e]===t){i=e;break}}}if(!1===i)return}if(n){const c=S.LightBox.el,f=a?c.querySelector('#'+a):null;let s;s=a?(ThemifyConstructor.settings[a]===I&&(ThemifyConstructor.settings[a]=[]),ThemifyConstructor.settings[a][i]===I&&(ThemifyConstructor.settings[a][i]={}),ThemifyConstructor.settings[a][i]):ThemifyConstructor.settings;for(let[e,a]of o){s[e]=a;let t;if((t=null!==f?f.querySelectorAll('[data-input-id="'+e+'"]')[i]:c.querySelector('.tb_lb_option#'+e))&&t.value!=a){t.value=a;let e=t.closest('.tb_uploader_wrapper');if(e)(e=e.querySelector('.tb_media_uploader img'))&&(e.src=a);else if(v&&'undefined'!=typeof tinyMCE&&tinyMCE){const m=tinyMCE.get(t.id);m&&m.setContent(a)}}}}else{const p=B.get('mod_settings')||{};if(a){p[a]===I&&(p[a]=[]),p[a][i]===I&&(p[a][i]={});for(let[e,t]of o)p[a][i][e]=t}else for(let[e,t]of o)p[e]=t;B.set('mod_settings',p)}ye(),e||(-1===C&&w&&(Q(w),w=null),Q(R.innerHTML))}}},j=e=>{e.preventDefault()},ee=e=>{e.stopImmediatePropagation(),y&&R&&(R.hasAttribute('data-name')||R.closest('[data-hasEditor]'))&&b.contains(e.target)&&!e.target.closest('.image_menu')&&T.image.result()},te=e=>{if(B&&R&&v&&!y){if(!0===e.ctrlKey||!0===e.metaKey){const t=q.activeElement.tagName,a=f.activeElement.tagName,s=e.code;'INPUT'!==t&&'TEXTAREA'!==t&&'INPUT'!==a&&'TEXTAREA'!==a&&('KeyY'===s||'KeyZ'===s&&!0===e.shiftKey?(e.preventDefault(),T.redo.state()&&T.redo.result()):'KeyZ'===s&&(e.preventDefault(),T.undo.state()&&T.undo.result()))}}else f.tfOff('keydown',te),q.tfOff('keydown',te)},x=()=>{const e=g.className,t=g.classList,a=(t.add('tf_hidden'),t.remove('tf_hide'),g.getBoundingClientRect());U=a.width+40,K=a.height+30,g.className=e},ae=()=>{const e=u.getSelection();_=!1===e.isCollapsed?e.getRangeAt(0).cloneRange():null},A=()=>{if(!1===t&&_){t=!0,R.focus();const e=u.getSelection();e.removeAllRanges(),e.addRange(_),t=!1}},se=()=>{if(null===g){if(P.classList.contains('tf_hide')){const e=P.firstElementChild,t=q.createDocumentFragment(),a=S.MainPanel.el.getRootNode().querySelector('#module_combine_style').cloneNode(!0),s=q.tfId('tmpl-builder_row_action').content.querySelector('#module_form_fields_style').cloneNode(!0);t.append(S.ToolBar.getBaseCss(),a,s),e&&(P.attachShadow({mode:e.getAttribute('shadowroot')}).appendChild(e.content),e.remove()),P.shadowRoot.prepend(t),P.classList.remove('tf_hide')}g=P.shadowRoot.tfId('toolbar'),m=g.querySelectorAll('[data-type]')}return g},ie=e=>{const t=e.target.closest('.action');if(e.stopPropagation(),t&&'submit'!==t.type){e.preventDefault(),d=!0;const a=t.closest('[data-type]').dataset.type;'expand'!==a?(-1===C&&w&&(Q(w),w=null),T[a]!==I&&T[a].result!==I?T[a].result(t):(A(),L(a)),de()):t.classList.contains('disable')||(u.getSelection().removeAllRanges(),B.edit(),X()),d=!1}},oe=e=>{const t=e.composedPath()[0];'BUTTON'!==t.tagName&&'SELECT'!==t.tagName&&'INPUT'!==t.tagName&&(e.stopPropagation(),e.preventDefault())},ne=e=>{e&&e.stopPropagation(),R&&(D=!0,Z())},le=function(e){if(e.stopPropagation(),'submit'===e.type||'focusout'===e.type&&!e.target.classList.contains('tb_range')||'change'===e.type&&e.target.classList.contains('tb_range'))'submit'===e.type&&e.preventDefault();else{const t=this.tfClass('link_input')[0],a=t.value.trim();if(a){D=!0,A();let e=u.getSelection();const s=_?_.startContainer.parentNode.closest('a'):null,i=this,o=i.querySelector('#link_type').value;if(s&&s===_.endContainer.parentNode.closest('a')){const n=q.createRange();n.selectNodeContents(s),e.removeAllRanges(),e.addRange(n)}if(L('createLink',a),ae(),e.anchorNode&&e.anchorNode.parentNode){const l=e.anchorNode.parentNode.closest('a');if(l)if(l.removeAttribute('target'),l.removeAttribute('data-zoom-config'),l.classList.remove('themify_lightbox'),'_blank'===o)l.target=o;else if('lightbox'===o){l.classList.add('themify_lightbox');const r=i.querySelector('#lb_w').value,d=i.querySelector('#lb_h').value,c=i.querySelector('#lb_w_unit').value||'px',f=i.querySelector('#lb_h_unit').value||'px';if(0<r||0<d){let e='|';r&&(e=r+c+e),d&&(e+=d+f),l.dataset.zoomConfig=e}}}}}},re=e=>{const t=e.parentNode,a=t.parentNode.closest('li');if(t.classList.add('selected'),a){a.classList.add('selected');const s=a.tfClass('action')[0];s!==I&&s.replaceWith(e.cloneNode(!0))}},de=()=>{for(let s=m.length-1;-1<s;--s){let e=m[s],t=e.dataset.type,a='LI'===e.tagName?e:e.parentNode;'expand'===t||'undo'===t||'image'===t||'redo'===t||a.classList.contains('disabled')||(T[t]!==I&&T[t].state!==I?T[t].state(a):a.classList.toggle('selected',i(t)))}},E=n=>{if(null!==g){const l=u.getSelection(),r=g.classList,d=l.isCollapsed;if(m)for(let e=m.length-1;-1<e;--e){let a=m[e],s=a.dataset.type;if('image'!==s&&'expand'!==s){let e='LI'===a.tagName?a:a.parentNode,t='undo'!==s&&'redo'!==s?d:!T[s].state();e.classList.toggle('disabled',t)}}r.contains('tf_hide')&&(x(),r.remove('tf_hide'),requestAnimationFrame(()=>{r.remove('tf_opacity')}));let e;if(!1===d)ae(),e=_,n===I&&de(),M&&(M.contains('tb_editor_start_select')||(P.classList.add('tb_editor_start_select'),M.add('tb_editor_start_select'),f.body.classList.add('tb_editor_start_select')),p&&clearTimeout(p),p=setTimeout(fe,500));else{if(_=null,ue(),0===l.rangeCount)return;e=l.getRangeAt(0).cloneRange()}let t=e.getBoundingClientRect(),a=(0===t.left&&0===t.top&&(t=R.getBoundingClientRect()),J(e.startContainer.parentNode)),s=t.left+(t.width-U)/2,i=t.top-K-10-a.diffTop,o=!1===d||!1===W;if(s+U>=k.w&&(s-=U+Math.ceil(s)+u.pageXOffset-k.w-1),!0===W&&!1===o){const c=g.getBoundingClientRect().top;o=c<=0||160<Math.abs(c-i)}!0===o&&(r.toggle('top_viewport',i<=0),i<=0&&(i=t.bottom+10),s<=0&&(s=15),i+=u.pageYOffset,g.style.transform='translate('+s+'px,'+i+'px)')}},ce=()=>{null!==R&&!1===t&&!1===d&&q.activeElement===R&&(o&&clearTimeout(o),c=requestAnimationFrame(()=>{o=setTimeout(()=>{null!==R&&!1===t&&!1===d&&q.activeElement===R&&E()},20)}))},fe=()=>{M&&M.contains('tb_editor_start_select')&&(f.body.classList.remove('tb_editor_start_select'),M.remove('tb_editor_start_select'),P.classList.remove('tb_editor_start_select')),p&&clearTimeout(p),p=null},me=()=>{const e=q.createElement('button');return e.type='button',e.className='tf_close',e.title='Back',e.tfOn(k.click,e=>{e.stopImmediatePropagation(),e.preventDefault(),ue(),g.classList.add('tf_hide','tf_opacity'),A(),x(),E()},{once:!0}),e},pe=e=>{const t=q.createElement('div'),a=q.createElement('div');t.id='dialog_header',a.id='dialog_content',a.tabIndex='-1',t.appendChild(me()),a.appendChild(e),h.append(t,a)},ue=()=>{if(g){if(g.style.display='none',h&&h.firstChild)for(;h.firstChild;)h.removeChild(h.lastChild);g.classList.remove('dialog_open','dialog_color','dialog_font','dialog_link','show_link'),g.style.display='',x()}},ge=e=>{if(ve(),null===g&&se(),null===b){b=q.createElement('div');const t=J(e),a=R.dataset.orig||R.currentSrc.trim(),s=-1===a.indexOf(k.upload_url)&&-1===a.indexOf('blob:')?themifyBuilder.i18n.img_help:null!==R.closest('[data-hasEditor]')&&themifyBuilder.i18n.img_help2,i=['w','s','e','n'],o={hflip:'ti-split-h',vflip:'ti-split-v',rotate:'ti-reload',pallete:'ti-palette',undo:'ti-back-left',redo:'ti-back-right'},n=q.createElement('div'),l=q.createDocumentFragment(),r=q.createDocumentFragment();b.id='image_editor',b.className='tf_abs_t',b.style.transform='translate('+t.left+'px,'+t.top+'px)',b.style.width=t.width+'px',b.style.height=t.height+'px',n.className='image_menu';for(let s=i.length-1;-1<s;--s){let e=q.createElement('div'),t=q.createElement('div'),a=q.createElement('div');e.className='image_handler tf_abs_t tb_editor_'+i[s],t.className='image_border tf_abs_t border_'+i[s],a.className='image_tooltip tf_opacity tf_textc tf_abs_t image_tooltip_'+i[s],t.dataset.axis=i[s],e.dataset.axis=i[s],l.append(t,a,e)}if(!1!==s)l.appendChild(ThemifyConstructor.help(s));else if(0){for(let a in o){let e=q.createElement('button'),t=q.createElement('span');e.dataset.action=a,e.type='button',e.className='tf_rel',t.className='themify_tooltip',t.textContent=themifyBuilder.i18n.img_menu[a],e.append(t,S.Helper.getIcon(o[a])),r.appendChild(e)}n.appendChild(r),n.tfOn(k.click,_e,{passive:!0}),l.appendChild(n)}b.tfOn('pointerdown',he,{passive:!0}),k.isTouch||b.tfOn('dblclick',ee,{passive:!0}),R.classList.add('tb_selected_img'),b.appendChild(l),P.shadowRoot.appendChild(b)}},he=async function(t){if(1===t.which){const o=t.target;if(t.stopPropagation(),R&&(R.hasAttribute('data-w')||R.hasAttribute('data-h')||R.closest('[data-hasEditor]'))&&(o.classList.contains('image_handler')||o.classList.contains('image_border'))){this.style.willChange='width,height,transform',R.parentNode.style.willChange='contents',R.style.willChange='width,height';let r,d,a,s,c,f,e=R.dataset.maxw,i=null,m=!1;if(!z){const E=(await Y()).ThemifyImageResize;z=new E(R)}e=(e=(e=e&&R.closest(e))||R.closest('[data-hasEditor]'))||R.parentNode;const n=o.dataset.axis,l=o.classList.contains('image_handler'),p=this,u=40,g=40,h=Number.MAX_VALUE,_=R.getBoundingClientRect(),b=parseInt(_.width),y=parseInt(_.height),v=parseFloat(b/y),C=t.clientX,w=t.clientY,N=p.tfClass('image_tooltip'),L=z.isLocal,T=q.createElement('div'),x=e=>{e.stopPropagation(),a=e.clientX,s=e.clientY,!1===m&&(m=!0),r&&cancelAnimationFrame(r),r=requestAnimationFrame(()=>{if(null===R)X();else{let e,t;!0===l?(e='n'===n||'s'===n?C+b-a:b+a-C,t=parseInt(e/v)):'s'===n||'n'===n?(t='s'===n?y+s-w:w+y-s,e=b):(e='w'===n?b+a-C:C+b-a,t=y),e<u?e=u:e>h&&(e=h),t!==I&&t<g&&(t=g),c===e&&f===t||(c=e,f=t,z.resize(e,t).then(e=>{const t=J(R);p.style.transform='translate('+t.left+'px,'+t.top+'px)',p.style.width=t.width+'px',p.style.height=t.height+'px',N[0].textContent=N[3].textContent=parseInt(e[1])+'px',N[1].textContent=N[2].textContent=parseInt(e[2])+'px',null!==i&&(i.style.width&&(i.style.width=e[1]+'px'),i.style.height&&(i.style.height=e[2]+'px')),ye()}))}})},A=async function(e){e&&e.stopPropagation(),r&&cancelAnimationFrame(r),d&&clearTimeout(d),this.tfOff('pointermove',x,{passive:!0}).tfOff('lostpointercapture',A,{passive:!0,once:!0}),P.classList.remove('tb_image_editor_resizing');const t=M||q.body.classList;if(t.remove('tb_start_animate','tb_image_editor_resizing'),!(p.style.willChange=R.style.willChange=R.parentNode.style.willChange='')===m){D=!0;let t=R.closest('.active_module,.module_column');Z();const a=R.getAttribute('width'),s=R.getAttribute('height'),i=()=>new Promise(async e=>{await k.trigger('tb_image_resize',[R,B,a,s]),ye(),t&&await S.Utils.runJs(t,'module'),H(),setTimeout(()=>{requestAnimationFrame(H),S.undoManager.has('inline')&&S.undoManager.end('inline'),e()},25)});if(t){const o=t.querySelectorAll('img[data-w="'+R.dataset.w+'"]');if(1<o.length){const n=[],l=(await Y()).ThemifyImageResize;L&&t.classList.add('tf_image_editor_working');for(let t=o.length-1;-1<t;--t)if(o[t]!==R)try{let e=new l(o[t]);n.push(e.highQuality(a,s))}catch(e){}try{await Promise.all(n),await i()}catch(e){}t.classList.remove('tf_image_editor_working')}else z.highQuality(a,s),i()}else i()}m=!1,r=d=c=f=F=null};if(P.classList.add('tb_image_editor_resizing'),M.add('tb_start_animate','tb_image_editor_resizing'),T.className='tf_loader tf_abs_c',this.appendChild(T),this.classList.add('image_loading'),!1===z.isLocal){const O=R.closest('[data-hasEditor]')?'img_help2':'img_help';S.Notification.showHide('warning',themifyBuilder.i18n[O],4e3)}else null!==(i=R.parentNode)&&'FIGURE'!==i.tagName||(i=null);z.lowQuality().then(()=>{!0===z.isBig&&S.Notification.showHide('warning',themifyBuilder.i18n.img_big.replace("%w",R.naturalWidth).replace("%h",R.naturalHeight),4e3),o.tfOn('pointermove',x,{passive:!0}),p.classList.remove('image_loading'),T.remove(),o.setPointerCapture(t.pointerId)}),o.tfOn('lostpointercapture',A,{passive:!0,once:!0})}}},_e=async e=>{e.stopPropagation();const t=e.target?e.target.closest('button'):null;if(t){const i=t.dataset.action;if(i){const a=(await Y()).ThemifyImageResize,o=new a(R,1,1);e.currentTarget,o.prms.then(()=>{if(!0===o.isBig)S.Notification.showHide('warning',themifyBuilder.i18n.img_big.replace("%w",R.naturalWidth).replace("%h",R.naturalHeight),4e3);else{let t;if('hflip'===i||'vflip'===i)t=o.flip('vflip'===i),F=null;else if('rotate'!==i&&'pallete'===i){let e=q.tfId('tb_pallete_root');if(e){const a=e.firstElementChild,s=q.createDocumentFragment();a&&(e.attachShadow({mode:a.getAttribute('shadowroot')}).appendChild(a.content),a.remove()),s.append(S.ToolBar.getBaseCss(),S.ToolBar.el.getRootNode().querySelector('#module_combine_style').cloneNode(!0),g.getRootNode().querySelector('#module_form_fields_style').cloneNode(!0)),e.shadowRoot.prepend(s),f.body.appendChild(e),t=k.loadCss(k.builder_url+'css/editor/modules/pallete',null,null,e.shadowRoot.lastElementChild)}else t=Promise.resolve();e=f.tfId('tb_pallete_root'),t.then(()=>{e.classList.remove('tf_hide'),(l=e.shadowRoot.tfId('pallete')).tfOn('input reset '+k.click,be,{passive:!0})})}z&&t&&t.then(()=>{z.updateEffects()})}})}}},be=e=>{if(e.stopPropagation(),'input'===e.type){const t=e.target,a=Math.trunc(t.value),s='range'===t.type?t.previousElementSibling:t.nextElementSibling,i=t.dataset.id;requestAnimationFrame(async()=>{if(s.value=a,!F){const e=(await Y()).ThemifyImageResize;F=new e(R,1,1),t.tfOn('change',e=>{F.save(1,F.ext)},{passive:!0,once:!0})}await F.prms,F.filter(i,a)})}},H=e=>{b&&!M.contains('tb_image_editor_resizing')&&requestAnimationFrame(()=>{b&&R&&!M.contains('tb_image_editor_resizing')&&ge(R)})},ye=()=>{null!==r&&r.update()},ve=()=>{b&&(b.tfOff('pointerdown',he,{passive:!0}).tfOff('dblclick',ee,{passive:!0}).remove(),b=F=null)},X=t=>{if(!(V||t&&1!==t.which)){let e=t?t.target:null;if(!(e&&g&&(1!==t.which||'tb_inline_editor_root'===e.id||g.contains(e)||l&&l.getRootNode().host.contains(e))))if(ue(),e&&B&&R&&R.contains(e))t&&R&&!1===u.getSelection().isCollapsed&&(M.contains('tb_editor_start_select')||(P.classList.add('tb_editor_start_select'),M.add('tb_editor_start_select'),f.body.classList.add('tb_editor_start_select')),this.tfOn('pointerup',fe,{passive:!0,once:!0}));else{if(c&&cancelAnimationFrame(c),o&&clearTimeout(o),q.tfOff('pointerdown',X,{passive:!0}).tfOff('selectionchange',ce,{passive:!0}).tfOff('pointerup',fe,{passive:!0,once:!0}).tfOff('keydown',te),f.tfOff('pointerdown',X,{passive:!0}).tfOff('keydown',te),fe(),R){R.tfOff('input',ne,{passive:!0}),'IMG'!==R.tagName&&R.setAttribute('contenteditable','false'),R.classList.remove('tb_selected_img');const a=R.closest('form');let e=R.closest('[draggable]');for(;null!==e;)e.draggable=!0,e=e.parentNode.closest('[draggable]');if(a){const s=a.tfOff('submit',j).querySelectorAll('[data-required]');for(let e=s.length-1;-1<e;--e)s[e].removeAttribute('data-required'),s[e].setAttribute('required','required')}let t=R;for(;t&&t.classList&&!t.classList.contains('active_module');)t.dataset.tmpAnimation&&(t.style.animationName=t.dataset.tmpAnimation,t.removeAttribute('data-tmp-animation')),t=t.parentNode}if(r&&r.params&&r.params.autoplay&&r.params.autoplay.enabled&&(r.el.dataset.stopped=!1,r.autoplay.start(),r.params.thumbs&&r.params.thumbs.swiper.autoplay&&r.params.thumbs.swiper.autoplay.enabled&&(r.params.thumbs.swiper.el.dataset.stopped=!1,r.params.thumbs.swiper.autoplay.start())),g&&(g.classList.add('tf_hide','tf_opacity'),g.tfOff(k.click,ie).tfOff('pointerdown',oe).classList.remove('top_viewport','show_link')),t&&u.getSelection().removeAllRanges(),k.off('tfsmartresize',H).off('tbresizeImageEditor',H).off('tbDisableInline',X),ve(),P.classList.remove('tb_editor_active','tb_editor_image_active','tb_editor_start_select'),M&&M.remove('tb_editor_active','tb_editor_image_active','tb_editor_start_select'),f.body.classList.remove('tb_editor_active','tb_editor_image_active','tb_editor_start_select'),l&&(l.getRootNode().host.classList.add('tf_hide'),l.tfOff('input reset '+k.click,be,{passive:!0})),R){const i=R.closest('.active_module');if(i&&(i.tfOff('dblclick',ee,{passive:!0}).classList.remove('tb_editor_on','tb_editor_clicked'),D)){Z();for(let a=S.LightBox.el.tfClass('CodeMirror'),s=a.length-1;-1<s;--s){let t=a[s].CodeMirror;if(t){let e=a[s].previousElementSibling;e&&(t.setValue(e.value),setTimeout(()=>{t.refresh()},10))}}R.hasAttribute('data-no-update')||S.Utils.runJs(i,'module')}}k.trigger('inlineEditorDisable',[B,R]),R&&S.undoManager.has('inline')&&S.undoManager.end('inline'),S.undoManager.clear('inline'),S.undoManager.enable(),N=[],C=-1,g=G=w=l=z=M=o=c=v=O=_=U=K=c=m=h=n=B=r=R=null}}};k.on('themify_builder_ready',()=>{let l=!1;S.Builder.get().el.tfOn('pointerdown',e=>{if((l=W=!1)!==S.isPreview||!0!==S.inlineEditor||1!==e.which||e.ctrlKey||e.metaKey)X();else{const a=(y='IMG'===e.target.tagName)?e.target:e.target.closest('[contenteditable]');if(a&&!a.closest('.tb_disable_sorting')&&(y||!1===a.contentEditable||'false'===a.contentEditable)){fe(),u.getSelection().removeAllRanges();const s=a.closest('.active_module');if(s){const i=S.Registry.get(s.dataset.cid);if(!i||i.get('mod_settings').__dc__!==I&&i.get('mod_settings').__dc__[a.dataset.name]!==I)return void X();s.classList.add('tb_editor_clicked')}y||(a.contentEditable=!0);let t=[],e=a.closest('[draggable]');for(;null!==e;)t.push(e),null!==!e.parentNode&&(e=e.parentNode.closest('[draggable]'));if(0<t.length){const o=e=>{q.tfOff('pointermove',n,{passive:!0,once:!0});for(let e=t.length-1;-1<e;--e)t[e].tfOff('drag',n,{passive:!0,once:!0}).draggable=!1},n=e=>{q.tfOff('pointermove',n,{passive:!0,once:!0}),a.tfOff('pointerup',o,{passive:!0,once:!0}).setAttribute('contenteditable',!1),s&&s.classList.remove('tb_editor_clicked');for(let e=t.length-1;-1<e;--e)t[e].tfOff('drag',n,{passive:!0,once:!0});ve(),'drag'===e.type&&X()};a.tfOn('pointerup',o,{passive:!0,once:!0}),q.tfOn('pointermove',n,{passive:!0,once:!0});for(let e=t.length-1;-1<e;--e)t[e].tfOn('drag',n,{passive:!0,once:!0})}l=!0}}},{passive:!0}).tfOn(k.click,e=>{if(l){let t=e.target;if(t.hasAttribute('data-target')){let e=t.closest('.active_module');(e=e&&e.querySelector(t.dataset.target))&&(t=e)}const s=(y='IMG'===t.tagName)?t:t.closest('[contentEditable]');if(s){if(s.closest('label,a,button')&&e.preventDefault(),R!==s)if(1===e.which&&(!y||s.dataset.w||s.dataset.h||s.dataset.name||s.closest('[data-hasEditor]'))){const i=s.closest('.active_module');if(i){if(X(),B=S.Registry.get(i.dataset.cid),!y){let a=B.get('mod_name').split('-'),s=a[0];for(let e=1,t=a.length;e<t;++e)s+=a[e].charAt(0).toUpperCase()+a[e].slice(1);O=S.BaseInLineEdit.items.get(s)}S.activeModel&&B.id===S.activeModel.el||S.undoManager.start('inline',i),S.undoManager.disable(),D=!1,R=s,M=q.body.classList,fe(),P.classList.add('tb_editor_active'),M.add('tb_editor_active'),f.body.classList.add('tb_editor_active'),v=!y&&s.hasAttribute('data-hasEditor'),i.classList.add('tb_editor_on'),i.classList.remove('tb_editor_clicked');let e=R,t=s.closest('form'),a=s.closest('[draggable]');if(t){const o=t.tfOn('submit',j).querySelectorAll('[required]');for(let e=o.length-1;-1<e;--e)o[e].removeAttribute('required'),o[e].dataset.required=1}for(;e&&e!==i;)e.style.animationName&&(e.dataset.tmpAnimation=e.style.animationName,e.style.animationName='none'),e=e.parentNode;for(;null!==a;)a.draggable=!1,a=a.parentNode.closest('[draggable]');e=a=t=null,(r=(r=R.closest('.tf_swiper-container'))&&r.swiper?r.swiper:null)&&r.params&&r.params.autoplay&&r.params.autoplay.enabled&&(r.el.dataset.stopped=!0,r.autoplay.stop(),r.params.thumbs&&r.params.thumbs.swiper&&r.params.thumbs.swiper.autoplay&&r.params.thumbs.swiper.autoplay.enabled&&(r.params.thumbs.swiper.el.dataset.stopped=!0,r.params.thumbs.swiper.autoplay.stop())),y?(M.add('tb_editor_image_active'),f.body.classList.add('tb_editor_image_active'),P.classList.add('tb_editor_image_active'),k.on('tfsmartresize',H).on('tbresizeImageEditor',H)):(R.contentEditable=!0,w=R.innerHTML,R.tfOn('input',ne,{passive:!0}).focus(),k.isTouch||setTimeout(()=>{i&&(i.tfOff('dblclick',ee,{passive:!0}).tfOn('dblclick',ee,{passive:!0}),themifyBuilder.disableShortcuts||(f.tfOn('keydown',te),q.tfOn('keydown',te)))},800)),k.on('tbDisableInline',X),q.tfOn('pointerdown',X,{passive:!0}),f.tfOn('pointerdown',X,{passive:!0}),v?(q.tfOn('selectionchange',ce,{passive:!0}),se(),x(),g.tfOn(k.click,ie).tfOn('pointerdown',oe),n=g.querySelector('#link_btn'),h=g.querySelector('#dialog'),setTimeout(()=>{requestAnimationFrame(E),g.querySelector('.expand').classList.toggle('tf_hide',S.activeModel===B)},30)):y&&(s.closest('.masonry')?k.requestIdleCallback(()=>{setTimeout(()=>{requestAnimationFrame(()=>{ge(s)})},25)},500):ge(s))}else X()}else X()}else X()}})},!0,S.is_builder_ready).on('disableInline',X),S.BaseInLineEdit=class{constructor(){S.BaseInLineEdit.items.set(this.constructor.name,this)}},S.BaseInLineEdit.items=new Map})(tb_app,Themify,jQuery,window,document,window.top.document,void 0);