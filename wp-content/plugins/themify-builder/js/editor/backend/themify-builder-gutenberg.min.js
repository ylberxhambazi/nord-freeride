'use strict';(function(h,m,k,b){let f=!1;const l=k.createElement,e={stateInit:!1,number:0,tempHTML:null,isRendered(){return null!==document.getElementById("tb_toolbar")},saveHTML(a){this.isRendered()&&(this.tempHTML=document.getElementById("tb_canvas_block").innerHTML)},restoreHTML(a){if("undefined"!==typeof tb_app&&this.tempHTML&&!this.isRendered()&&document.getElementById("tb_canvas_block")&&(document.getElementById("tb_canvas_block").innerHTML=this.tempHTML,tb_app.Instances.Builder[0])){a=document.getElementById("tb_row_wrapper").querySelectorAll("[data-cid]");
a=Array.prototype.slice.call(a);for(let c=a.length-1;-1<c;--c){let d=tb_app.Models.Registry.lookup(a[c].getAttribute("data-cid"));d&&d.trigger("change:view",a[c])}tb_app.toolbar.setElement(b("#tb_toolbar")).render();tb_app.toolbarCallback();tb_app.Instances.Builder[0].setElement(b("#tb_row_wrapper"));tb_app.Instances.Builder[0].init(!0)}},manageState(a){"undefined"===typeof tb_app||this.stateInit||(this.stateInit=!0,tb_app.vent.on("dom:change",function(){tb_app.hasChanged&&a.setAttributes({data:e.number++})}),
tb_app.vent.on("backend:switchfrontend",function(c){window.top.location.href=c}),document.getElementById("block-"+a.clientId).removeAttribute("tabIndex"))},saveBlock(){"undefined"!==typeof tb_app&&(f?f=!1:tb_app.hasChanged?tb_app.Utils.saveBuilder(this.goToFrontend):this.goToFrontend())},goToFrontend(){tb_app.redirectFrontend&&tb_app.vent.trigger("backend:switchfrontend",tb_app.redirectFrontend)}},g=function(){e.saveBlock()};h.registerBlockType("themify-builder/canvas",{title:"Themify Builder",icon:"layout",
category:"layout",useOnce:!0,edit(a){setTimeout(function(){e.saveHTML(a);e.restoreHTML(a);e.manageState(a);Themify.trigger("tb_canvas_loaded")},800);return l("div",{id:"tb_canvas_block"},"placeholder builder")},save(){return null}});b(function(){b("body").on("click",".editor-post-publish-button, .editor-post-save-draft",function(a){tb_app.hasChanged&&tb_app.Utils.saveBuilder(function(){f=!0})}).off("click.frontend-btn","#tb_switch_frontend").on("click.frontend-btn","#tb_switch_frontend",function(){b(".editor-post-publish-button").on("DOMSubtreeModified",
function(){this.classList.contains("is-busy")||b(".editor-post-saved-state").length||(f=!1,g())})})});b(document).ajaxComplete(function(a,c,d){"POST"===d.type&&void 0!==window.themifyBuilder&&themifyBuilder.post_ID&&-1!==d.url.indexOf("post.php?post="+themifyBuilder.post_ID+"&action=edit&classic-editor=1&meta_box=1")&&setTimeout(g,800)})})(window.wp.blocks,window.wp.i18n,window.wp.element,jQuery);
