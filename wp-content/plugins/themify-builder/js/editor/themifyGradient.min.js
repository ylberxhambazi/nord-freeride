'use strict';(function(k,H,h,B){k.ThemifyGradient=function(q,G){const F={gradient:k.ThemifyGradient.default,width:173,height:15,point:8,angle:180,circle:!1,type:"linear",onChange(){},onInit(){}},D=k(q);let n,m,w,x,y,z,g=[];this.initSwatchesFlag=this.isInit=!1;this.settings={};this.__constructor=function(){this.settings=k.extend({},F,G);this.update();this.settings.onInit();this.isInit=!0;return this};this.updateSettings=function(a){this.settings=k.extend({},F,a);this.update();return this};this.update=
function(){this._setupPoints();this._setup();this._render()};this.getCSSvalue=function(){const a=[],b="radial"===this.settings.type?this.settings.circle?"circle,":"":this.settings.angle+"deg,";for(let c=0,d=g.length;c<d;++c)a.push(g[c][1]+" "+g[c][0]);return this.settings.type+"-gradient("+b+a.join(", ")+")"};this.getString=function(){let a="";for(let b=0,c=g.length;b<c;++b)a+=g[b][0]+" "+g[b][1]+"|";return a.substr(0,a.length-1)};this.setType=function(a){this.settings.type=a;this.settings.onChange(this.getString(),
this.getCSSvalue())};this.setAngle=function(a){this.settings.angle=a;this.settings.onChange(this.getString(),this.getCSSvalue())};this.setRadialCircle=function(a){this.settings.circle=a;this.settings.onChange(this.getString(),this.getCSSvalue())};this._setupPoints=function(){g=[];g=Array.isArray(this.settings.gradient)?this.settings.gradient:this._getGradientFromString(this.settings.gradient)};this._setup=function(){const a=this,b=h.createDocumentFragment(),c=h.createElement("div"),d=h.createElement("div"),
f=h.createElement("span"),e=h.createElement("span"),r=h.createElement("div"),A=h.createElement("div");y=h.createElement("a");w=h.createElement("div");x=h.createElement("input");n=h.createElement("div");m=h.createElement("div");let v=h.createElement("canvas");c.className="themifyGradient tf_rel";v.width=this.settings.width;v.height=this.settings.height;n.className="points";w.className="point-color";f.className="gradient_delimiter";e.className="gradient_percent";e.innerHTML="%";x.type="text";x.className=
"point-position";y.className="gradient-point-delete tf_close";y.href="#";d.className="gradient-pointer-info";m.className="content";r.style.backgroundColor="#00ff00";A.className="gradient-pointer-arrow";w.appendChild(r);d.appendChild(A);m.appendChild(w);m.appendChild(f);m.appendChild(x);m.appendChild(e);m.appendChild(y);b.appendChild(n);b.appendChild(v);d.appendChild(m);b.appendChild(d);for(c.appendChild(b);q.firstChild;)q.removeChild(q.firstChild);q.appendChild(c);this.initSwatchesFlag||(q.parentNode.appendChild(this.swatchesHTML()),
this.initSwatches(),this.initSwatchesFlag=!0);m=k(m);w=k(w);x=k(x);y=k(y);n=k(n);z=v.getContext("2d");v=k(v);v.off("click").on("click",function(p){const C=k(this).offset();let t="rgba(0,0,0, 1)",u=999999999999;p=p.pageX-C.left;p=Math.round(100*p/a.settings.width);for(let l=0,E=g.length;l<E;++l)g[l][0]=parseInt(g[l][0]),g[l][0]<p&&p-g[l][0]<u?(u=p-g[l][0],t=g[l][1]):g[l][0]>p&&g[l][0]-p<u&&(u=g[l][0]-p,t=g[l][1]);g.push([p+"%",t]);g.sort(a._sortByPosition);a._render();for(let l=0,E=g.length;l<E;++l)g[l][0]===
p+"%"&&a._selectPoint(n.find(".point:eq("+l+")")[0]);"visual"===B.mode&&setTimeout(a._colorPickerPosition,315)});this.pointEvents()};this.pointEvents=function(){const a=this,b=B.Utils.getMouseEvents(),c=function(d){const f=d.target;if(f.classList.contains("point-position")){let e=parseInt(f.value.trim());isNaN(e)?e=0:0>e?e=Math.abs(e):98<=e&&(e=98);"focusout"!==d.type?(e=Math.round(e*a.settings.width/100),k(f).closest(".themifyGradient").find(".themify_current_point").css("left",e),a._renderCanvas()):
f.value=e}};m[0].addEventListener("focusout",c,{passive:!1});m[0].addEventListener("keyup",c,{passive:!1});n[0].addEventListener("keyup",function(d){const f=d.keyCode||d.which||0;8!==f&&46!==f||"INPUT"===h.activeElement.tagName||(x.focus(),a.removePoint(d))},{passive:!1});n[0].addEventListener("click",function(d){d.target.classList.contains("point")&&(a._selectPoint(d.target),"visual"===B.mode&&a._colorPickerPosition())},{passive:!0});n[0].addEventListener(b.mousedown,function(d){if(("touchstart"===
d.type||1===d.which)&&d.target.classList.contains("point")){d.stopImmediatePropagation();let f;const e=d.target,r=function(t){q.focus();e.classList.add("tb_gradient_drag_point");this.body.classList.add("tb_start_animate","tb_move_drag","tb_gradient_drag")},A=a.settings.width,v=parseFloat(window.getComputedStyle(e).getPropertyValue("margin-left"))||0,p=e.offsetLeft-(d.touches?d.touches[0].clientX:d.clientX),C=function(t){t.stopImmediatePropagation();f&&cancelAnimationFrame(f);f=requestAnimationFrame(function(){let u=
p+(t.touches?t.touches[0].clientX:t.clientX)-v;u>A?u=A:0>u&&(u=0);e.style.left=u+"px";a._selectPoint(e,!0);a._renderCanvas()})};h.addEventListener(b.mouseup,function(t){t.stopImmediatePropagation();this.removeEventListener(b.mousemove,r,{passive:!0,once:!0});this.removeEventListener(b.mousemove,C,{passive:!0});this.body.classList.remove("tb_start_animate","tb_move_drag","tb_gradient_drag");e.classList.remove("tb_gradient_drag_point");q.focus()},{passive:!0,once:!0});h.addEventListener(b.mousemove,
r,{passive:!0,once:!0});h.addEventListener(b.mousemove,C,{passive:!0})}},{passive:!0})};this._render=function(){this._initGradientPoints();this._renderCanvas()};this._colorPickerPosition=function(){const a=ThemifyBuilderCommon.Lightbox.$lightbox,b=m.find(".tfminicolors"),c=b.find(".tfminicolors-panel");0<c.length&&(a.offset().left+a.width()<=c.offset().left+c.width()?b.addClass("tb_minicolors_right"):b.removeClass("tb_minicolors_right"))};this._initGradientPoints=function(){const a=h.createDocumentFragment();
for(;n[0].firstChild;)n[0].removeChild(n[0].firstChild);for(let b=0,c=g.length;b<c;++b){let d=h.createElement("div");d.className="point";d.style.backgroundColor=g[b][1];d.style.left=parseInt(g[b][0])*this.settings.width/100+"px";a.appendChild(d)}n[0].appendChild(a)};this.hexToRgb=function(a){a=a.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(b,c,d,f){return c+c+d+d+f+f});return(a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a))?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:
null};this._selectPoint=function(a,b){if(a){var c=this,d=parseInt(a.style.left);x.val(Math.round(d/this.settings.width*100));d-=30;0>d&&h.body.classList.contains("tb_module_panel_docked")&&(d=3);m[0].parentNode.style.marginLeft=d+"px";if(b)return!1;D.focus();var f=k(a);f.addClass("themify_current_point").siblings().removeClass("themify_current_point");b=f.css("backgroundColor");a=b.substr(4,b.length);a=a.substr(0,a.length-1);D.find(".point-color .tfminicolors").remove();a=w.find(".themify-color-picker");
0===a.length&&(a=k('<input type="text" class="themify-color-picker" />'),a.appendTo(w).tfminicolors({opacity:!0,changeDelay:10,change(e,r){e=c.hexToRgb(e);e||(e={r:255,g:255,b:255},r=1);f.css("backgroundColor","rgba("+e.r+","+e.g+","+e.b+","+r+")");c._renderCanvas()}}),D.find(".tfminicolors").first().addClass("tfminicolors-focus"),y.off("click").on("click",this.removePoint.bind(this)));b=b.replace(/^rgba?\(|\s+|\)$/g,"").split(",");d=4===b.length?b.pop():1;b=this._rgbToHex(b);a.val(b).attr("data-opacity",
d).data("opacity",d).tfminicolors("settings",{value:b})}};this._renderCanvas=function(){const a=n[0].getElementsByClassName("point");g=[];for(let b=0,c=a.length;b<c;++b){let d=Math.round(parseInt(a[b].style.left)/this.settings.width*100);g.push([d+"%",a[b].style.backgroundColor])}g.sort(this._sortByPosition);this._renderToCanvas();if(this.isInit)this.settings.onChange(this.getString(),this.getCSSvalue())};this._renderToCanvas=function(){const a=z.createLinearGradient(0,0,this.settings.width,0);for(let b=
0,c=g.length;b<c;++b)a.addColorStop(parseInt(g[b][0])/100,g[b][1]);z.clearRect(0,0,this.settings.width,this.settings.height);z.fillStyle=a;z.fillRect(0,0,this.settings.width,this.settings.height)};this._getGradientFromString=function(a){const b=[];a=a.split("|");for(let d=0,f=a.length;d<f;++d){var c=void 0;let e=a[d];c=e.indexOf("%");let r=e.substr(c-3,c);"100"===r||"100%"===r?c="100%":(c=1<c?parseInt(e.substr(c-2,c)):parseInt(e.substr(c-1,c)),c+="%");b.push([c,e.replace(c,"")])}return b};this._rgbToHex=
function(a){function b(f){f=parseInt(f,10);if(isNaN(f))return"00";f=Math.max(0,Math.min(f,255));return"0123456789ABCDEF".charAt((f-f%16)/16)+"0123456789ABCDEF".charAt(f%16)}const c=a[1],d=a[2];return"#"+b(a[0])+b(c)+b(d)};this._sortByPosition=function(a,b){a=parseInt(a[0]);b=parseInt(b[0]);return a<b?-1:a>b?1:0};this.removePoint=function(a){a.preventDefault();if(1<g.length){g.splice((void 0).index(),1);const b=m[0].parentNode;b.style.display="none";setTimeout(function(){b.style.display=""},50);this._render()}};
this.swatchesHTML=function(){const a=h.createDocumentFragment(),b=h.createElement("div"),c=h.createElement("ul"),d=themifyColorManager.makeImportExportDropdown(),f=h.createElement("a");f.className="tb_gradient_add_swatch tf_plus_icon";let e=h.createElement("span");e.className="themify_tooltip";e.innerText=ThemifyConstructor.label.save_gradient;f.appendChild(e);f.href="#";f.addEventListener("click",this.saveSwatch.bind(this));b.className="tf_cm_dropdown_icon";b.tabIndex=1;e=h.createElement("span");
e.className="themify_tooltip";e.innerText=ThemifyConstructor.label.ie_gradient;b.appendChild(e);d.addEventListener("click",this.swatchesDropdownClicked.bind(this));b.appendChild(B.Utils.getIcon("ti-import"));b.appendChild(d);c.className="tb_gradient_swatches";c.addEventListener("click",this.swatchClicked.bind(this));a.appendChild(f);a.appendChild(b);a.appendChild(c);return a};this.swatchesDropdownClicked=function(a){a.preventDefault();a.stopPropagation();a=a.target;const b=a.classList;b.contains("tb_cm_export")?
(a.parentNode.parentNode.parentNode.blur(),h.location.assign(themifyCM.exportGradientsURL)):b.contains("tb_cm_import")&&(a.parentNode.parentNode.parentNode.blur(),themifyColorManager.importColors("gradients"))};this.saveSwatch=function(){if(""===this.getString()||""===this.getCSSvalue())return!1;var a=Object.keys(themifyCM.gradients),b=this.getCSSvalue();for(let c=a.length-1;-1<c;--c)if(themifyCM.gradients[a[c]].css===b)return null;a=themifyColorManager.UID();b={id:a,setting:JSON.parse(JSON.stringify(this.settings)),
gradient:this.getString(),css:b,points:g};themifyCM.gradients[a]=b;this.addSwatch(b);themifyColorManager.updateColorSwatches("gradients")};this.addSwatch=function(a,b){const c=h.createElement("li"),d=h.createElement("span");c.className="tb_gradient_swatch";c.style.background=a.css;c.dataset.id=a.id;d.className="tf_delete_swatch tf_close";c.appendChild(d);if(b)a=q.parentElement.getElementsByClassName("tb_gradient_swatches")[0],a.insertBefore(c,a.firstChild);else{a=ThemifyBuilderCommon.Lightbox.$lightbox[0].getElementsByClassName("tb_gradient_swatches");
for(let f=0,e=a.length;f<e;++f)a[f].insertBefore(c.cloneNode(!0),a[f].firstChild)}};this.swatchClicked=function(a){a.preventDefault();a=a.target;const b=a.classList;b.contains("tb_gradient_swatch")?this.selectSwatch(a.dataset.id):b.contains("tf_delete_swatch")&&(this.removeSwatch(a.parentNode.dataset.id),themifyColorManager.updateColorSwatches("gradients"))};this.removeSwatch=function(a){const b=ThemifyBuilderCommon.Lightbox.$lightbox[0].querySelectorAll('.tb_gradient_swatch[data-id="'+a+'"]');for(let c=
b.length-1;-1<c;--c)b[c].parentNode.removeChild(b[c]);delete themifyCM.gradients[a]};this.selectSwatch=function(a){a=themifyCM.gradients[a];this.setAngle(a.setting.angle);this.setRadialCircle(a.setting.circle);this.setType(a.setting.type);this.settings.gradient=a.gradient;this.update();var b=q.parentElement;const c=b.getElementsByClassName("themify-gradient-type")[0],d=b.querySelector('input[type="checkbox"]');b=b.getElementsByClassName("tb_angle_input")[0];c.value=a.setting.type;Themify.triggerEvent(c,
"change");d.checked=a.setting.circle;Themify.triggerEvent(d,"change");b.value=a.setting.angle;Themify.triggerEvent(b,"change")};this.initSwatches=function(){const a=Object.keys(themifyCM.gradients);themifyCM.gradients=a.length?themifyCM.gradients:{};for(let b=0,c=a.length;b<c;++b)this.addSwatch(themifyCM.gradients[a[b]],!0)};return this.__constructor()};k.ThemifyGradient.default="0% rgba(0,0,0, 1)|100% rgba(255,255,255,1)";k.fn.ThemifyGradient=function(q){return this.each(function(){void 0===k(this).data("themifyGradient")&&
k(this).data("themifyGradient",new k.ThemifyGradient(this,q))})}})(jQuery,window.top,window.top.document,tb_app);
